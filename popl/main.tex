%%
%% This is file `sample-sigconf.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% samples.dtx  (with options: `sigconf')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from sample-sigconf.tex.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file samples.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
%%
%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0
%%
%%
%% The first command in your LaTeX source must be the \documentclass command.


% Fixing: Too many math alphabets used in version normal.
\newcommand\hmmax{0}
\newcommand\bmmax{0}
\documentclass[acmsmall,review,screen,dvipsnames]{acmart}

\usepackage[colorinlistoftodos]{todonotes}
\usepackage[inference]{semantic}
\usepackage{fontawesome5}
\usepackage{glossaries}
\usepackage{cleveref}
\usepackage{stmaryrd}
\usepackage{listings}
\usepackage{xspace}
\usepackage{tikz}
\usepackage{bm}

\input{cmds.tex}

\loadglsentries{acronyms}
\makeglossaries

%% NOTE that a single column version may be required for 
%% submission and peer review. This can be done by changing
%% the \doucmentclass[...]{acmart} in this template to 
%% \documentclass[manuscript,screen]{acmart}
%% 
%% To ensure 100% compatibility, please check the white list of
%% approved LaTeX packages to be used with the Master Article Template at
%% https://www.acm.org/publications/taps/whitelist-of-latex-packages 
%% before creating your document. The white list page provides 
%% information on how to submit additional LaTeX packages for 
%% review and adoption.
%% Fonts used in the template cannot be substituted; margin 
%% adjustments are not allowed.
%%
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
\setcopyright{acmcopyright}
\copyrightyear{2024}
\acmYear{2024}
\acmDOI{XXXXXXX.XXXXXXX}

%% These commands are for a PROCEEDINGS abstract or paper.
\acmConference[POPL '24]{Make sure to enter the correct
  conference title from your rights confirmation emai}{June 03--05,
  2018}{Woodstock, NY}
%
%  Uncomment \acmBooktitle if th title of the proceedings is different
%  from ``Proceedings of ...''!
%
%\acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
%  June 03--05, 2018, Woodstock, NY} 
\acmPrice{15.00}
\acmISBN{978-1-4503-XXXX-X/18/06}


%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% For managing citations, it is recommended to use bibliography
%% files in BibTeX format.
%%
%% You can then either use BibTeX with the ACM-Reference-Format style,
%% or BibLaTeX with the acmnumeric or acmauthoryear sytles, that include
%% support for advanced citation of software artefact from the
%% biblatex-software package, also separately available on CTAN.
%%
%% Look at the sample-*-biblatex.tex files for templates showcasing
%% the biblatex styles.
%%

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
\citestyle{acmauthoryear}

%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Secure Composition of Robust and Optimising Compilers}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.
\author{Matthis Kruse}
% \authornote{Both authors contributed equally to this research.}
\email{matthis.kruse@cispa.de}
\orcid{0000-0003-4062-9666}
\affiliation{%
  \institution{CISPA Helmholtz Center for Information Security}
  \streetaddress{Stuhlsatzenhaus 5}
  \city{Saarbr{\"u}cken}
  \state{Saarland}
  \country{Germany}
  \postcode{66123}
}

\author{Marco Patrignani}
\orcid{0000-0003-3411-9678}
\email{marco.patrignani@unitn.it}
\affiliation{%
  \institution{University of Trento}
  \streetaddress{Via Sommarive, 9}
  \city{Povo}
  \country{Italy}
  \postcode{38123}
}

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
\renewcommand{\shortauthors}{Kruse and Patrignani}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\begin{abstract}
  \hltt{abstract}

\begin{center}\small\it
	{In the following, we use syntax highlighting accessible to both colourblind and black \& white readers~\citep{patrignani2020use}. 
	Specifically, we use a $\src{blue}$, $\src{sans\text{-}serif}$ font for our $\src{source}$,
	a $\trg{red}$, $\trg{bold}$ font for our $\trg{intermediate}$, 
	and a $\obj{green}$, $\obj{teletype}$ font for our $\obj{target}$ language.
	}
\end{center}
\end{abstract}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%
\begin{CCSXML}
<ccs2012>
  <concept>
  <concept_id>10002978.10002986.10002989</concept_id>
  <concept_desc>Security and privacy~Formal security models</concept_desc>
  <concept_significance>500</concept_significance>
  </concept>
</ccs2012>
\end{CCSXML}
\ccsdesc[500]{Security and privacy~Formal security models}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{Memory-safety, Secure Compilation, Privacy}

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

\section{Introduction}

\hltt{Context}
\hltt{Problem}

\BrText{Solution}{
% keyword: pass
\MPin{
	commands missing
}
This paper introduces a framework for reasoning about the composition of secure and optimising compiler passes and it showcases the power of this framework by instantiating it on a multi-pass compilation chain.
To this end, this paper first discusses how to compose security properties, such as temporal and spatial memory safety into general memory safety, and cryptographic constant time.
Then, this paper defines several secure compiler passes, where each is either preserving a different security property (e.g., temporal or spatial memory safety) or performing a security-preserving optimisation, (e.g., applying constant-folding or dead-code elimination).
% keyword- end to end, composition
Finally, this paper shows how to compose these secure compiler passes into a multi-pass compilation chain which can be proven to provide end-to-end preservation of general memory safety and cryptographic constant time.
\MKin{
  ,,can be proven'' -> we prove (?)
}
Crucially, this end-to-end security preservation is obtained by having each compilation pass (i) preserve a sub-part of the overall security property individually and then (ii) compose each preserved security property as dictated by our framework.
Our results showcase how our framework allows the kind of formal security reasoning that compiler writers already want (and do), obtaining precise, compositional security reasoning while providing minimal (and modular) proof effort.
\MPin{
	last line: not the best.
}
}

\BrText{Validation}{In summary, this paper makes the following contributions:

\begin{itemize}
  \item
        \Cref{sec:compprop} presents a formal framework to reason about compositions of security properties and demonstrate its usage with concrete examples:
        Given a most general trace model, we define the trace-based security properties \gls{tms}, \gls{sms}, \gls{ms}, \gls{cct}, and their compositions.
        For each of these properties, we also give a monitor which runs on another trace model that excludes unneccessary information and show that their composition is behaviorally similar to the composition of the trace-based security properties.
        This two-level approach enhances modularity: When working with the security properties, one only needs to reason about the corresponding monitor.

  \item
        \Cref{sec:compcomp} studies different forms of secure compiler compositions.
        Concretely, it investigates upper and lower compositions, as well as the sequential composition.
        A simple corollary of sequential composition is the ability to freely reorder compiler optimizations without compromising security.

  \item \Cref{sec:casestud} sets up a case-study to demonstrate the power of our formal framework.
        We define several different languages and compilers between them and prove that the compilers are robustly preserving different properties.
        The sequential composition of these compilers yields a compilation chain that is optimizing and robustly preserving a combination of \gls{ms} and \gls{cct}.
        As for optimizations, the chain has two passes, one performing \gls{cf} and the other \gls{dce}.
        This compilation chain demonstrates the ability to perform modular proof engineering by leaveraging this paper's compositionality theorems.

  \item Our key contributions are formalized in the Coq proof assistant.
        The formalization for the compilers are \emph{extractable}.
        That is, one can translate our Coq code to Ocaml and run them.
        Finally, in this paper, whenever definitions or proofs are done in Coq, we use the symbol \CoqSymbol.
\end{itemize}}

We now describe the other sections of the paper.
In \Cref{sec:background}, the paper establishes the notions of traces, (hyper-)properties, and robust preservation, while \Cref{sec:relwork} compares this work with others.
We conclude in \Cref{sec:concl} and give an outlook for future work.

\contribution{Open Source \& Technical Report} Our technical report and the Coq formalisation are
available as supplementary material and will be made available upon acceptance of this paper.


\section{Background}\label{sec:background}
\Cref{subsec:bg:tprop} introduces trace properties, monitors, and property satisfaction.
\Cref{subsec:bg:rtp} extends the property satisfaction with robustness and shows its compiler-driven preservation, as presented in~\cite{abate2019jour}.

\subsection{Trace-Based Properties, Programming Languages, and Property Satisfaction}\label{subsec:bg:tprop}

\emph{Events} $\event$ are an abstract representation of observable actions a program can do during its execution.
Typically, one always has an empty observation $\emptyevent$ used to represent unimportant actions.
A sequence of events $\trace$ is a \emph{trace}.
So, throughout the paper, we use $\overline{\cdot}$ to mark meta-variables as sequences.
Empty sequences are denoted with $\hole{\cdot}$ and concatenation of traces $\trace[_{1}],\trace[_{2}]$ is written as $\trace[_{1}]\cdot\trace[_{2}]$.
For sake of brevity, we use this notation also for pre- and appending events to traces.

A trace-based property $\pi$ is a set of admissable traces.
For a trace to be admissable, a predicate evaluates to true whenever $\trace\in\pi$.
Classes of properties $\class$, commonly referred to as hyperproperties in literature, are sets of properties.
The \emph{lifting} of a property $\pi$ is simply its powerset and denoted as $\lift{\pi}$.
To define property satisfaction, we first look at programming languages.

For languages used in this paper, we consider a small-step style semantics.
That is, there is a step relation between states $\statevar$ and an event $\event$: $\stepto[]{\statevar[_{1}]}{\statevar[_{2}]}{\event}$.
Also, a program's syntax $p$ is encoded in the state $\statevar$ which we write as $p\in\statevar$.
For states $\statevar$, we assume there exists a judgement $\isval{\statevar}$ that determines wether $\statevar$ is a final state or not.
\Cref{fig:starstep:and:nstep}\MK{appendix?} defines the star-step relation $\stepto{\statevar[_{1}]}{\statevar[_{2}]}{\trace}$, essentially modelling a big-step style evaluation, and the $n$-step relation $\stepton{\statevar[_{1}]}{\statevar[_{2}]}{\trace}$ that evaluates a program for $n$ steps.
Both relations filter $\varepsilon$ events.

\begin{figure}[t]
  \judgbox{\stepto{r}{r'}{\trace}}{,,State $\statevar$ steps to final state $\statevar[']$, emitting events $\trace$.''}$\;$\\
  %
  \typerule{star-step-refl}{
    \isval{\statevar}
  }{
    \stepto{\statevar}{\statevar}{\hole{\cdot}}
  }{star-step-refl}
  %
  \typerule{star-step-trans}{
    \event\not=\varepsilon &
    \stepto[]{\statevar}{\statevar[']}{\event} &
    \stepto{\statevar[']}{\statevar['']}{\trace}
  }{
    \stepto{\statevar}{\statevar['']}{\event\cdot\trace}
  }{star-step-trans}
  %
  \typerule{star-step-ign}{
    \stepto[]{\statevar}{\statevar[']}{\varepsilon} &
    \stepto{\statevar[']}{\statevar['']}{\trace}
  }{
    \stepto{\statevar}{\statevar['']}{\trace}
  }{star-step-ign}

  \judgbox{\stepton{\statevar}{\statevar[']}{\trace}}{,,State $r$ does $n$ steps to final state $\statevar[']$, emitting events $\trace$.''}$\;$\\
  %
  \typerule{n-step-refl}{
  }{
    \stepton[0]{\statevar}{\statevar}{\hole{\cdot}}
  }{n-step-refl}
  %
  \typerule{n-step-trans}{
    \event\not=\varepsilon &
    \stepto[]{\statevar}{\statevar[']}{\event} &
    \stepton{\statevar[']}{\statevar['']}{\trace}
  }{
    \stepton[n+1]{\statevar}{\statevar['']}{\event\cdot\trace}
  }{n-step-trans}
  %
  \typerule{n-step-ign}{
    \stepto[]{\statevar}{\statevar[']}{\varepsilon} &
    \stepton{\statevar[']}{\statevar['']}{\trace}
  }{
    \stepton[n+1]{\statevar}{\statevar['']}{\trace}
  }{n-step-ign}

  \caption{Star-step and $n$-step relation for a given step relation $\stepto{\statevar[_{1}]}{\statevar[_{2}]}{\event}$}\label{fig:starstep:and:nstep}
\end{figure}
%
The \emph{behavior} of a whole program $w$ ($\behav{w}$) is a set containing all traces the program may emit during execution.
Note that for deterministic languages, $\behav{w}$ is a singleton set for any $w$.
With this, we can define satisfaction:

\begin{definition}[Property Satisfaction]\label{def:propsat}
  A \emph{whole} program $w$ satisfies $\pi$ ($\sat{w}{\pi}$) iff $\behav{w}\in\lift{\pi}$.
\end{definition}
\begin{definition}[Class Satisfaction]\label{def:classsat}
  A \emph{whole} program $w$ satisfies $\class$ ($\sat{w}{\class}$) iff $\behav{w}\in\class$.
\end{definition}

\subsection{Attacker Model and Robust Trace-Property Preservation}\label{subsec:bg:rtp}

Partial programs cannot be executed, because they lack definitions for some symbols.
Providing definitions for symbols is usually the job of the \emph{linker}.
We denote linking two programs $\progvar[_{1}],\progvar[_{2}]$ as $\link{\progvar[_{1}]}{\progvar[_{2}]}$.
For sake of simplicity, we assume that linking does not fail.
With linking, we can define robust satisfaction analogously to \Cref{def:propsat,def:classsat}:

\begin{definition}[Robust Property Satisfaction]\label{def:proprsat}
  A program $\progvar$ robustly satisfies $\pi$ ($\rsat{\progvar}{\pi}$) iff for any program $\contextvar$ we have $\sat{\link{\contextvar}{\progvar}}{\pi}$. (similarily for $\rsat{\progvar}{\class}$)
\end{definition}

Robust satisfaction gives rise to a maximally powerful attacker model: Any other partial program, here referred to as context $\contextvar$, is the attacker.
So, for example, if the programming language of $\progvar$ and $\contextvar$ allows guessing of memory addresses, then $\contextvar$ is able to read and write any position in memory and therefore guess the location of secrets.

We expect compilers to preserve robust satisfaction.
In this paper, compilers are modelled as function from one programming language's syntax to the other.
Since this paper considers composing compilers, we'll adopt notation similar to tombstone diagrams to easen the formal burden.
So, we denote a compiler from $\src{L}$ to $\trg{L}$ as $\cc{\src{L}\to\trg{L}}{\src{\bullet}}$ and we refer to $\src{L}$ as \emph{source} language and to $\trg{L}$ as \emph{target} language.
Composing $\cc{\src{L}\to\trg{L}}{\src{\bullet}}$ with $\cc{\trg{L}\to\obj{L}}{\trg{\bullet}}$ is denoted as $\cc{\src{L}\to\trg{L}\to\obj{L}}{\src{\bullet}}$ and means first running $\cc{\src{L}\to\trg{L}}{\src{\bullet}}$ and plugging the output into $\cc{\trg{L}\to\obj{L}}{\trg{\bullet}}$.
Contrary to tombstones, we don't consider a compiler's implementation language.
We now define the compiler-property robust trace-property preservation.

\begin{definition}[Robust Trace-Property Preservation]\label{def:rtp}
  A compiler $\cc{\src{L}\to\trg{L}}{\src{\bullet}}$ robustly preserves a class of properties $\class$ ($\rtp{\cc{\src{L}\to\trg{L}}{\src{\bullet}}}{\class}$) iff for any property $\pi\in\class$ and $\src{p}$ written in $\src{L}$, given $\rsat{\src{\progvar}}{\pi}$, then $\rsat{\cc{\src{L}\to\trg{L}}{\src{\progvar}}}{\pi}$.
\end{definition}

Note that in the conclusion of \Cref{def:rtp} there is a target-level context.
So, programs that robustly satisfy a property are hardened against a maximally malicious environment with respect to the power of the target language.

\section{Composing Properties}\label{sec:compprop}
\Cref{subsec:propdefs} introduces a ,,most general'' trace model and defines properties (\gls{tms}, \gls{sms}, \gls{ms}, and \gls{cct}) that our case study (\Cref{sec:casestud}) uses.
By means of taking these properties as an example, \Cref{subsec:monitors} defines monitors for them and an agreement relation between a monitor's trace model with the most general trace model.
Then, we define monitor-based satisfaction and we prove that trace-property satisfaction is implied by it.
Since monitor-based satisfaction is easier to reason about, this makes our later proofs considerably simpler.

\subsection{Most General Trace-Model and Some Property Definitions}\label{subsec:propdefs}

\begin{gather*}
  \begin{aligned}
  \mi{(Security\ Tag)}~\sigma\bnfdef&\ \lock \mid \unlock\hspace{0.5cm}
  \mi{(Control\ Tag)}~\sandboxtag\bnfdef \ctx\mid\comp\\
  \mi{(Pre\text{--}event)}~\event[_{b}]\bnfdef&\ \ev{Alloc\ \loc\ n} \mid \ev{Dealloc\ \loc} \mid \ev{Use\ \loc\ n} \mid \ev{Branch\ n} \mid \ev{Binop\ n} \\
  \mi{(Event)}~\event\bnfdef&\ \emptyevent \mid \lightning \mid \event[_{b}];\sandboxtag;\sigma \\
  \end{aligned}
\end{gather*}

Security tags describe wether an event contains sensitive information ($\lock$) or not ($\unlock$).
Control tags state wether the context ($\ctx$) or the component ($\comp$) are responsible for emitting the event.
Pre-events describe the actual kind of event that happened.
$\ev{Alloc\ \loc\ n}$ states that an allocation of size $n$ happened and is stored at $\loc$.
Locations $\loc$ are elements of $L$ and left abstract.
However, we expect $L$ to be closed over addition with natural numbers.
$\ev{Dealloc\ \loc}$ announces that location $\loc$ is freed.
$\ev{Use\ \loc\ n}$ abstracts over reads from $\loc$ and writes to $\loc$ in memory, where $n$ is read/written, respectively.
$\ev{Branch\ n}$ and $\ev{Binop\ n}$ leak values involved in a branch or in a binary operation with data-dependent execution time.
Finally, events are either the emptyevent ($\emptyevent$), a program crash ($\lightning$), or a tuple consisting of a pre-event, a control tag, and a security tag.

We use this trace model to define any property that interests us.
In a sense the trace model is most general, because it abstracts all events done in our languages as defined in \Cref{sec:casestud}.
We write $\event[_{1}]\le_{\trace}\event[_{2}]$ if $\event[_{1}]$ occurs at an earlier position in $\trace$ than $\event[_{2}]$.

\gls{tms} requires that pointers are freed exactly once and that no use happens after a free.

\begin{definition}[\glsfirst{tms}]\label{def:trace:tmsdef}
  A trace $\trace$ is temporal memory safe ($\trace\in\tmssafe$) iff $\ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}\le_{\trace}\ev{Dealloc\ \loc;\sandboxtag';\securitytag'}$, $\ev{Use\ \loc\ n;\sandboxtag;\securitytag}\not\le_{\trace}\ev{Alloc\ \loc\ m;\sandboxtag';\securitytag'}$ and $\ev{Use\ \loc\ n;\sandboxtag;\securitytag}\not\le_{\trace}\ev{Dealloc\ \loc;\sandboxtag';\securitytag'}$.
\end{definition}

\gls{sms} disregards out of bounds accesses.

\begin{definition}[\glsfirst{sms}]\label{def:trace:smsdef}
  A trace $\trace$ is spatial memory safe ($\trace\in\smssafe$) iff given $\ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}\le_{\trace}\ev{Use\ \loc\ m;\sandboxtag';\securitytag'}$, then $n<m$.
\end{definition}

Full \gls{ms} is then described as the conjunction of \Cref{def:trace:tmsdef,def:trace:smsdef}.

\begin{definition}[\glsfirst{ms}]\label{def:trace:msdef}
  A trace $\trace$ is memory safe ($\trace\in\mssafe$) iff $\trace\in\tmssafe$ and $\trace\in\smssafe$.
\end{definition}

We define a variant of the \gls{cct} security property.
Generally, one cannot define \gls{cct} just as trace-property without, e.g., performing a self-composition of a program.
That's why we adopt for a stricter variant of \gls{cct}, called \gls{scct}, that enforces common policies to ensure code is \gls{cct}.
For example, one must not branch on secrets or perform binary operations, such as division, on secrets whose timing is data-dependent.
We opt for a definition that disregards any secrets leaked on a trace.
To define the property, we need a function on traces that strips all events with a $\lock$-tag: $\downarrow_{\lock}(\cdot)$.

\begin{definition}[\glsfirst{scct}]
  A trace $\trace$ is strictly cryptographic constant time ($\trace\in\scctsafe$) iff $\trace=\downarrow_{\lock}\left(\trace\right)$.
\end{definition}

\subsection{Monitors and Trace Agreements}\label{subsec:monitors}

This subsection presents monitors for our properties of interest (\gls{tms}, \gls{sms}, \gls{ms}, \gls{scct}).
Each monitor $\monitor$ has its own accompanying trace model that abstracts over our most general trace model.
%This is because monitors should only be concerned with property-relevant information.
Traces of the accompanying trace model are written as $\abstrace$ and $\monitorcheck{\monitor}{\monitor[']}{\abstrace}$ is the notation for the semantics of a monitor.
The empty monitor is denoted as $\emptyset$.
For each model of a monitor, an agreement relation $\traceagree{\pi}{\trace}{\abstrace}$ is defined that relates monitor specific traces with most general traces.
The notation $\traceagree[]{\pi}{\event}{\absevent}$ is used to relate just events and the star version of it is defined similarily to \Cref{fig:starstep:and:nstep}.
With this, first, monitor satisfaction is defined and then the individual monitors.
Finally, for every monitor, it is shown that monitor satisfaction implies trace property satisfaction.

\begin{definition}[Monitor Satisfaction]\label{def:monsat}
  A given trace $\trace$ monitor-satisfies a property $\pi$ ($\monsafe{\trace}{\pi}$) iff %
  there exists $\abstrace,\monitor$ such that $\traceagree{\pi}{\trace}{\abstrace}$ and $\monitorcheck{\emptyset}{\monitor}{\abstrace}$.
  \Coqed
\end{definition}

\paragraph{Monitor for \glsfirst{tms}}
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\tmsmonitor\bnfdef&\ \left\{\text{alloced}:L,\text{freed}:L\right\} \hspace{0.33cm}%
    \emptyset:=\ \left\{\text{alloced}:\emptyset,\text{freed}:\emptyset\right\}\\
    \mi{(Abstract\ Events)}~\absevent\bnfdef&\ \absev{\emptyevent} \mid \absev{Alloc\ }\loc \mid \absev{Dealloc\ }\loc \mid \absev{Use\ }\loc \mid \absterm\\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absevent}}{,,Monitor $\tmsmonitor$ steps to $\tmsmonitor[']$ given event $\absevent$.''}$\;$\\
  %
  \typerule{tms-uninteresting}{
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor}{\absev{\emptyevent}}
  }{tms-uninteresting}
  %
  \typerule{tms-abort}{
  }{
    \monitorcheck[]{\tmsmonitor}{\emptyset}{\absterm}
  }{tms-abort}
  %
  \typerule{tms-use}{
    \loc\in\tmsmonitor.\text{alloced} &
    \loc\notin\tmsmonitor.\text{freed}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor}{\absev{Use\ }\loc}
  }{tms-use}
  %
  \typerule{tms-alloc}{
    \loc\notin\tmsmonitor.\text{alloced} &
    \loc\notin\tmsmonitor.\text{freed} \\
    \tmsmonitor[']=\left\{\text{alloced}: \tmsmonitor.\text{alloced}\cup\left\{\loc\right\},\text{freed}: \tmsmonitor.\text{freed}\right\}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absev{Alloc\ }\loc}
  }{tms-alloc}
  %
  \typerule{tms-dealloc}{
    \loc\notin\tmsmonitor.\text{alloced} &
    \loc\notin\tmsmonitor.\text{freed} \\
    \tmsmonitor[']=\left\{\text{alloced}: \tmsmonitor.\text{alloced}\setminus\left\{\loc\right\},\text{freed}: \tmsmonitor.\text{freed}\cup\left\{\loc\right\}\right\}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absev{Dealloc\ }\loc}
  }{tms-dealloc}
\end{center}
\begin{center}
  \judgbox{\tmstraceagree[]{\event}{\absevent}}{,,Abstract event $\absevent$ is equivalent to $\event$ with respect to \gls{tms}.''}$\;$\\
  %
  \typerule{tms-alloc-authentic}{
  }{
    \tmstraceagree[]{\ev{Alloc}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Alloc\ }\loc}
  }{tms-alloc-authentic}
  %
  \typerule{tms-dealloc-authentic}{
  }{
    \tmstraceagree[]{\ev{Dealloc}\ \loc;\sandboxtag;\securitytag}{\absev{Dealloc\ }\loc}
  }{tms-dealloc-authentic}
  %
  \typerule{tms-use-authentic}{
  }{
    \tmstraceagree[]{\ev{Use}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Use\ }\loc}
  }{tms-use-authentic}
  %
  \typerule{tms-branch-authentic}{
  }{
    \tmstraceagree[]{\ev{Branch\ }n}{\absev{\emptyevent}}
  }{tms-branch-authentic}
  %
  \typerule{tms-binop-authentic}{
  }{
    \tmstraceagree[]{\ev{Binop\ }n}{\absev{\emptyevent}}
  }{tms-binop-authentic}
  %
  \typerule{tms-empty-authentic}{
  }{
    \tmstraceagree[]{\emptyevent}{\absev{\emptyevent}}
  }{tms-empty-authentic}
  %
  \typerule{tms-abort-authentic}{
  }{
    \tmstraceagree[]{\lightning}{\absterm}
  }{tms-abort-authentic}
\end{center}

The state of the monitor is a record containing two sets that keep track of allocated and freed locations.
The monitor runs on a modified trace semantics with more abstract $\absev{Alloc\ }\loc$,$\absev{Dealloc\ }\loc$,$\absev{Use\ }\loc$, and $\absterm$ events, which represent {\em allocation}, {\em deallocation}, and {\em use} of a location $\loc$ as well as abnormal program termination.
\Cref{tr:tms-use} simply requires that a location is (i) allocated and (ii) not freed.
\Cref{tr:tms-alloc,tr:tms-dealloc} both require a location to not be freed already and depending on the witnessed action, extend the internal state of the monitor.
The trace agreement is entirely straightforward.

\begin{lemma}[Traces with Monitor Satisfaction are $\tmssafe$]\label{lem:mon:tmsafe}
  If $\montmssafe{\trace}$, then $\trace\in\tmssafe$.\Coqed
\end{lemma}

\paragraph{Monitor for \glsfirst{sms}}
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\smsmonitor:=\ L\times\mb{N}\hspace{0.33cm}&
    \mi{(Abstract\ Events)}~\absevent\bnfdef\ \absev{\varepsilon} \mid \absev{Alloc\ }\loc\ n \mid \absev{Dealloc\ }\loc \mid \absev{Use\ }\loc\ n \\
  \end{aligned}
\end{gather*}
\MKin{do we really need $\absev{Dealloc}$?}
\begin{center}
  \judgbox{\monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\absevent}}{,,Monitor $\smsmonitor$ steps to $\smsmonitor[']$ given event $\absevent$.''}$\;$\\
  %
  \typerule{sms-uninteresting}{
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor}{\absev{\emptyevent}}
  }{sms-uninteresting}
  %
  \typerule{sms-abort}{
  }{
    \monitorcheck[]{\smsmonitor}{\emptyset}{\absterm}
  }{sms-abort}
  %
  \typerule{sms-use}{
    (\loc,m)\in\smsmonitor &
    n<m
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor}{\absev{Use\ }\loc\ n}
  }{sms-use}
  %
  \typerule{sms-alloc}{
    \loc\notin\operatorname{dom}\smsmonitor &
    \smsmonitor[']=\smsmonitor\cup\left\{(\loc,n)\right\}
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\absev{Alloc\ }\loc\ n}
  }{sms-alloc}
  %
  \typerule{sms-dealloc}{
    (\loc,n)\in\smsmonitor &
    \smsmonitor[']=\smsmonitor\setminus\left\{(\loc,n)\right\}
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\absev{Dealloc\ }\loc}
  }{sms-dealloc}
\end{center}
\begin{center}
  \judgbox{\smstraceagree[]{\event}{\absevent}}{,,Abstract event $\absevent$ is equivalent to $\event$ with respect to \gls{sms}.''}$\;$\\
  %
  \typerule{sms-alloc-authentic}{
  }{
    \smstraceagree[]{\ev{Alloc}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Alloc\ }\loc\ n}
  }{sms-alloc-authentic}
  %
  \typerule{sms-dealloc-authentic}{
  }{
    \smstraceagree[]{\ev{Dealloc}\ \loc;\sandboxtag;\securitytag}{\absev{Dealloc\ }\loc}
  }{sms-dealloc-authentic}
  %
  \typerule{sms-use-authentic}{
  }{
    \smstraceagree[]{\ev{Use}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Use\ }\loc\ n}
  }{sms-use-authentic}
  %
  \typerule{sms-branch-authentic}{
  }{
    \smstraceagree[]{\ev{Branch\ }n}{\absev{\emptyevent}}
  }{sms-branch-authentic}
  %
  \typerule{sms-binop-authentic}{
  }{
    \smstraceagree[]{\ev{Binop\ }n}{\absev{\emptyevent}}
  }{sms-binop-authentic}
  %
  \typerule{sms-empty-authentic}{
  }{
    \smstraceagree[]{\emptyevent}{\absev{\emptyevent}}
  }{sms-empty-authentic}
  %
  \typerule{sms-abort-authentic}{
  }{
    \smstraceagree[]{\lightning}{\absterm}
  }{sms-abort-authentic}
\end{center}

The state of the monitor for \gls{sms} is a set containing pairs of locations and the allocation size of the objects the locations point to.
In comparison to the trace model of the \gls{tms} monitor, the trace model here is extended by sizing and positional information.
\Cref{tr:sms-use} performs a bounds check and \Cref{tr:sms-alloc,tr:sms-dealloc} add or remove locations and the size of an allocation.
The trace agreement relation is, again, entirely straightforward.

\begin{lemma}[Monitor Traces are $\smssafe$]\label{lem:mon:smsafe}
  If $\monsmssafe{\trace}$, then $\trace\in\smssafe$.\Coqed
\end{lemma}

\paragraph{Comining Monitors: \glsfirst{ms}}

\begin{center}
  \judgbox{\monitorcheck[]{\msmonitor}{\msmonitor[']}{\absevent}}{,,Monitor $\msmonitor$ steps to $\msmonitor[']$ given event $\absevent$.''}$\;$\\
  \typerule{ms-step}{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absevent_{\tmssafe}} &
    \monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\absevent_{\smssafe}} &
  }{
    \monitorcheck[]{(\tmsmonitor,\smsmonitor)}{(\tmsmonitor['],\smsmonitor['])}{(\absevent_{\tmssafe},\absevent_{\smssafe})}
  }{ms-step}
\end{center}
\begin{center}
  \judgbox{\mstraceagree{\event}{\absevent}}{,,Abstract event $\absevent$ is equivalent to $\event$ with respect to \gls{ms}.''}$\;$\\
  %
  \typerule{ms-authentic}{
    \tmstraceagree[]{\event}{\absevent_{\tmssafe}} &
    \smstraceagree[]{\event}{\absevent_{\smssafe}}
  }{
    \mstraceagree[]{\event}{(\absevent_{\tmssafe},\absevent_{\smssafe})}
  }{ms-authentic}
\end{center}

To obtain a monitor for \gls{ms}, the monitors for \gls{tms} and \gls{sms} are simply combined in lock-step.

\begin{lemma}[Monitor Traces are $\mssafe$]\label{lem:mon:msafe}
  If $\monmssafe{\trace}$, then $\trace\in\mssafe$.\Coqed
\end{lemma}

\paragraph{Monitor for \glsfirst{scct}}
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\scctmonitor&:=\ \emptyset \\
    \mi{(Abstract\ Events)}~\absevent&:=\ \absev{\varepsilon} \mid \absterm \mid \absev{Any} \\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\absevent}}{,,Monitor $\scctmonitor$ steps to $\scctmonitor[']$ given event $\absevent$.''}$\;$\\
  %
  \typerule{scct-none}{
  }{
    \monitorcheck[]{\scctmonitor}{\scctmonitor}{\absev{\emptyevent}}
  }{scct-none}
  %
  \typerule{scct-abort}{
  }{
    \monitorcheck[]{\scctmonitor}{\scctmonitor}{\absterm}
  }{scct-abort}
\end{center}
\begin{center}
  \judgbox{\sccttraceagree[]{\event}{\absevent}}{,,Abstract event $\absevent$ is equivalent to $\event$ with respect to \gls{cct}.''}$\;$\\
  %
  \typerule{scct-low-authentic}{
  }{
    \sccttraceagree[]{\event[_b];\sandboxtag;\unlock}{\absev{\emptyevent}}
  }{scct-low-authentic}
  %
  \typerule{scct-high-authentic}{
  }{
    \sccttraceagree[]{\event[_b];\sandboxtag;\lock}{\absev{Any}}
  }{scct-high-authentic}
  %
  \typerule{scct-empty-authentic}{
  }{
    \sccttraceagree[]{\emptyevent}{\absev{\emptyevent}}
  }{scct-empty-authentic}
  %
  \typerule{scct-abort-authentic}{
  }{
    \sccttraceagree[]{\lightning}{\absterm}
  }{scct-abort-authentic}
\end{center}

The \gls{scct} monitor simply disregards all private data occuring on a trace.

\MKin{combined version of all monitors? maybe just as lemma}

\section{Composing Robustly Secure Compilers}\label{sec:compcomp}
This section studies different kinds of secure compiler compositions and their corresponding proofs.
Most notably, it looks at the sequential composition of secure compilers and shows a theorem that allows for modular proof engineering: compilers need not to robustly preserve the same property in order to be securely composed.
Moreover, it demonstrates that the order does not matter for composing compilers with the same source and target language.

\section{Case Study: Memory Safe and Cryptographic Constant Time Code}\label{sec:casestud}
This section defines several secure compilers, each of which robustly preserves a different property of interest.
We demonstrate the power of our framework from \Cref{sec:compprop,sec:compcomp} by composing these compilers for a secure, but optimizing, compilation chain that robustly preserves \gls{ms} and \gls{cct}.
Concretely, \Cref{subsec:cs:tms} starts by defining languages $\src{L_{TMS}}$ and $\trg{L}$ and describes a compiler $\cc{\src{L_{TMS}}\to\trg{L}}{\src{\bullet}}$ for the robust preservation of \gls{tms} between the two languages.
\Cref{subsec:cs:ms} defines $\irl{L_{MS}}$ and a compiler $\cc{\trg{L}\to\irl{L_{MS}}}{\trg{\bullet}}$ that robustly preserves \gls{sms}.
By the framework presented in \Cref{sec:compcomp,sec:compprop}, we attain a compiler $\cc{\src{L_{TMS}}\to\irl{L_{MS}}}{\src{\bullet}}$ for the robust preservation of \gls{ms} by composing $\cc{\src{L_{TMS}}\to\trg{L}}{\src{\bullet}}$ and $\cc{\trg{L}\to\irl{L_{MS}}}{\trg{\bullet}}$.
\Cref{subsec:cs:scct} defines $\obj{L_{CCT}}$ and a compiler $\cc{\irl{L_{MS}}\to\obj{L_{CCT}}}{\irl{\bullet}}$ that robustly preserves \gls{cct}.
Composing it with $\cc{\src{L_{TMS}}\to\irl{L_{MS}}}{\src{\bullet}}$ yields $\cc{\src{L_{TMS}}\to\obj{L_{CCT}}}{\src{\bullet}}$, a compiler that robustly preserves a combination of \gls{ms} and \gls{cct}.
We attain our final compilation chain in \Cref{subsec:cs:opts}, which defines optimizing compilers performing either \gls{cf} or \gls{dce} and composes them with $\cc{\src{L_{TMS}}\to\obj{L_{CCT}}}{\src{\bullet}}$, giving us an optimizing, secure compilation chain.

\subsection{Robust Temporal Memory Safety Preservation}\label{subsec:cs:tms}
\subsection{Robust (Spatial) Memory Safety Preservation}\label{subsec:cs:ms}
\subsection{Robust Strict Cryptographic Constant Time Preservation}\label{subsec:cs:scct}
\subsection{Optimizing Compilers}\label{subsec:cs:opts}

%\begin{lstlisting}[language=c,caption=``Wrong bounds check of two 64-bit integers.'']
%if at <= bounds {
%  x[at] = 42;
%}
%\end{lstlisting}
%Note the subtle bug of using \verb|<=| instead of \verb|<|, leading to an out-of-bounds access whenever \verb|at = bounds|.
%Furthermore, when \verb|at| and \verb|bounds| are 64-bit integers on a 32-bit architecture, the comparison may not be performed in constant-time: The compiler may bail out as soon as the lower 32 bits are unequal, not bothering to compare the higher 32 bits.


\section{Related Work}\label{sec:relwork}
\section{Conclusion}\label{sec:concl}


%% The acknowledgments section is defined using the "acks" environment
%% (and NOT an unnumbered section). This ensures the proper
%% identification of the section in the article metadata, and the
%% consistent spelling of the heading.
\begin{acks}
\end{acks}

%%
%% The next two lines define the bibliography style to be used, and
%% the bibliography file.
\bibliographystyle{ACM-Reference-Format}
\bibliography{main}

%%
%% If your work has an appendix, this is the place to put it.
\appendix

\end{document}
\endinput
%%
%% End of file `sample-sigconf.tex'.
