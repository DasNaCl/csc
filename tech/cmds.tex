\usepackage[T1]{fontenc}
\usepackage[dvipsnames]{xcolor}
\usepackage{fontawesome5}
\usepackage{listofitems}
\usepackage{mathpartir}
\usepackage{glossaries}
\usepackage{mathtools}
\usepackage{tcolorbox}
\usepackage{graphicx}
\usepackage{stmaryrd}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{mdframed}
\usepackage{amsmath}
\usepackage{amssymb} %uncomment for ieee
\usepackage{nameref}
\usepackage{xspace}
\usepackage{array}
\usepackage{tikz}
\usepackage{soul}
\usepackage{bm}

\usepackage{noindentafter}

%%%% patch for enumitem
%% https://github.com/jbezos/enumitem/issues/48
\makeatletter
\@namedef{enitkv@enumitem-resume@resume*@default}{%
   \let\enit@resuming\thr@@
  \enit@ifunset{enit@resumekeys@\@currenvir}
    % Nothing to resume if this is the first occurrance of \@currenvir.
    % An empty \enit@resumekeys results in \enitkv@setkeys{enumitem}{,resume}
    % called in \enit@setresume.
    {\def\enit@resumekeys{}}
    {\let\enit@resuming\thr@@
     \expandafter\let\expandafter\enit@resumekeys
       \csname enit@resumekeys@\@currenvir\endcsname
     \@nameuse{enit@resume@\@currenvir}\relax}%
  }
\makeatother
%%%%

%% Line numbering. Remember to use \linenumbers after \begin{document}
\usepackage[right]{lineno}
\renewcommand\thelinenumber{\color{red}\arabic{linenumber}}

%%%%
% TODO macros. not using todonotes package, since it's damn slow
\newcommand{\todo}[2][red]{\colorbox{#1}{\begin{minipage}{0.9\textwidth}{#2}\end{minipage}}}
\newcommand{\MKin}[1]{\todo[orange!30]{MK: #1}}
\newcommand{\MPin}[1]{\todo[blue!30]{MP: #1}}

%% General utility
% List of contributions
\newcounter{contrib}
\newcommand{\contribnum}[0]{\stepcounter{contrib}{\arabic{contrib}}.~}
\newcommand{\contribution}[1]{\smallskip\noindent\textbf{{#1.}\xspace}}

 % fonts
\newcommand{\mi}[1]{\ensuremath{\mathit{#1}}}
\newcommand{\mr}[1]{\ensuremath{\mathrm{#1}}}
\newcommand{\mt}[1]{\ensuremath{\texttt{#1}}}
\newcommand{\mtt}[1]{\ensuremath{\mathtt{#1}}}
\newcommand{\mf}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\mk}[1]{\ensuremath{\mathfrak{#1}}}
\newcommand{\mc}[1]{\ensuremath{\mathcal{#1}}}
\newcommand{\ms}[1]{\ensuremath{\mathsf{#1}}}
\newcommand{\mb}[1]{\ensuremath{\mathbb{#1}}}
\newcommand{\msc}[1]{\ensuremath{\mathscr{#1}}}

% underlines
\newcommand{\bul}[1]{{\setulcolor{RoyalBlue}\ul{#1}}}
\newcommand{\rul}[1]{{\setulcolor{RedOrange}\ul{#1}}}
\newcommand{\iul}[1]{{\setulcolor{Apricot}\ul{#1}}}
\newcommand{\oul}[1]{{\setulcolor{Emerald}\ul{#1}}}
\newcommand{\pul}[1]{{\setulcolor{CarnationPink}\ul{#1}}}

% Colors
\newcommand{\neutcol}[0]{black}
\newcommand{\stlccol}[0]{RoyalBlue}
\newcommand{\irccol}[0]{Apricot}
\newcommand{\ulccol}[0]{RedOrange}
\newcommand{\objcol}[0]{Emerald} %CarnationPink}
\newcommand{\commoncol}[0]{black}
\newcommand{\irdcol}[0]{CarnationPink}

\newcommand{\col}[2]{\ensuremath{{\color{#1}{#2}}}}

\newcommand{\com}[1]{\ensuremath\mathit{\col{\neutcol}{#1}}}
\newcommand{\src}[1]{\ensuremath\mathsf{\col{\stlccol}{#1}}}
\newcommand{\irl}[1]{\ensuremath\mathit{\col{\irccol}{#1}}}
\newcommand{\trg}[1]{\ensuremath\mathbf{\col{\ulccol}{#1}}}
\newcommand{\obj}[1]{\ensuremath\mathtt{\col{\objcol}{#1}}}
\newcommand{\ird}[1]{\ensuremath\mathit{\col{\irdcol}{#1}}}

%% theorem stuff
\newenvironment{proof}[1][\textbf{Proof}]%
{\everypar={{\setbox0=\lastbox}\everypar{}}\restartlist{passumptionslist}\par\noindent\ignorespaces\mbox{\textsc{#1}.}$\;$\\\noindent\everypar={{\setbox0=\lastbox}\everypar{}}}
{$\;$\hfill$\square$\\\ignorespacesafterend%
\ifx\paslistend\undefined\else\global\let\paslistend\undefined\fi%
}
% Theorem environments
\Crefname{exampleenv}{Example}{Examples}
\Crefname{definitionenv}{Definition}{Definitions}
\Crefname{lemmaenv}{Lemma}{Lemmata}
\Crefname{theoremenv}{Theorem}{Theorems}
\Crefname{corollaryenv}{Corollary}{Corollaries}
\Crefname{axiomenv}{Axiom}{Axioms}
\newcounter{example}
\newcounter{definition}
\newcounter{lemma}
\newcounter{theorem}
\newcounter{corollary}
\newcounter{axiom}

% defining theorem environments for their specialized versions
\makeatletter
\newenvironment{base@thm}[3]%
{\ifx\paslistend\undefined\else\global\let\paslistend\undefined\fi%
  $\;$\linebreak\noindent\mbox{$\triangleright\;\textsc{\textbf{\large #1} #2 (#3).}$}}
{\hfill$\;$\linebreak}
\makeatother

% example environments take a label and a name
\crefname{example}{example}{examples}
\makeatletter
\newenvironment{example}[1]%
{\refstepcounter{example}\begin{base@thm}{Example}{\theexample}{#1}}
{\end{base@thm}\noindent}
% referencing an example
\newcommand{\examplelabel}[2][PLACEHOLDER]{{#1}\label[example]{example:#2}\def\@currentlabel{#1}\label{t@example:#2}}
%\def\@currentlabel{#1}\label{t@example:#2}}
\newcommand{\exampleref}[1]{\Cref{example:#1}~(\ref{t@example:#1})}
\makeatother
% definition environments take a label and a name
\crefname{definition}{definition}{definitions}
\makeatletter
\newenvironment{definition}[1]%
{\refstepcounter{definition}\begin{base@thm}{definition}{\thedefinition}{#1}}
{\end{base@thm}\noindent}
% referencing an definition
\newcommand{\definitionlabel}[2][PLACEHOLDER]{{#1}\label[definition]{definition:#2}\def\@currentlabel{#1}\label{t@definition:#2}}
%\def\@currentlabel{#1}\label{t@definition:#2}}
\newcommand{\definitionref}[1]{\Cref{definition:#1}~(\ref{t@definition:#1})}
\newcommand{\defref}[1]{\Cref{definition:#1}}
\makeatother
% lemma environments take a label and a name
\crefname{lemma}{lemma}{lemmas}
\makeatletter
\newenvironment{lemma}[1]%
{\refstepcounter{lemma}\begin{base@thm}{lemma}{\thelemma}{#1}}
{\end{base@thm}\noindent}
% referencing an lemma
\newcommand{\lemmalabel}[2][PLACEHOLDER]{{#1}\label[lemma]{lemma:#2}\def\@currentlabel{#1}\label{t@lemma:#2}}
%\def\@currentlabel{#1}\label{t@lemma:#2}}
\newcommand{\lemmaref}[1]{\Cref{lemma:#1}~(\ref{t@lemma:#1})}
\newcommand{\lemref}[1]{\Cref{lemma:#1}}
\makeatother
% corollary environments take a label and a name
\crefname{corollary}{corollary}{corollarys}
\makeatletter
\newenvironment{corollary}[1]%
{\refstepcounter{corollary}\begin{base@thm}{corollary}{\thecorollary}{#1}}
{\end{base@thm}\noindent}
% referencing an corollary
\newcommand{\corollarylabel}[2][PLACEHOLDER]{{#1}\label[corollary]{corollary:#2}\def\@currentlabel{#1}\label{t@corollary:#2}}
%\def\@currentlabel{#1}\label{t@corollary:#2}}
\newcommand{\corollaryref}[1]{\Cref{corollary:#1}~(\ref{t@corollary:#1})}
\makeatother
% axiom environments take a label and a name
\crefname{axiom}{axiom}{axioms}
\makeatletter
\newenvironment{axiom}[1]%
{\refstepcounter{axiom}\begin{base@thm}{axiom}{\theaxiom}{#1}}
{\end{base@thm}\noindent}
% referencing an axiom
\newcommand{\axiomlabel}[2][PLACEHOLDER]{{#1}\label[axiom]{axiom:#2}\def\@currentlabel{#1}\label{t@axiom:#2}}
%\def\@currentlabel{#1}\label{t@axiom:#2}}
\newcommand{\axiomref}[1]{\Cref{axiom:#1}~(\ref{t@axiom:#1})}
\makeatother

% referencing a rule
\newcommand{\trref}[1]{\Cref{tr:#1}}

% some cool operators
\newcommand{\isdef}[0]{\ensuremath{\mathrel{\overset{\makebox[0pt]{\mbox{\normalfont\tiny\sffamily def}}}{=}}}}


% sandwiching
\newcommand{\lift}[1]{\ensuremath\lfloor\xspace{#1}\xspace\rfloor}
\newcommand{\hole}[1]{\ensuremath{\left[#1\right]}}
\newcommand{\denot}[1]{\ensuremath\left\llbracket#1\right\rrbracket\xspace}
\newcommand{\lrpars}[1]{\ensuremath\left(#1\right)\xspace}
\newcommand{\lrbrackets}[1]{\ensuremath\left[#1\right]\xspace}
\newcommand{\lrbraces}[1]{\ensuremath\left\{#1\right\}\xspace}
\newcommand{\lrbbraces}[1]{\ensuremath\left\llbracket{#1}\right\rrbracket\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Language-Specific
\newcommand{\varWholeProg}[1][]{\ensuremath w_{#1}}
\newcommand{\varComponent}[1][]{\ensuremath p_{#1}}
\newcommand{\varContext}[1][]{\ensuremath C_{#1}}
\newcommand{\varRuntimeTerm}[1][]{\ensuremath r_{#1}}

\newcommand{\varTrace}[1][]{\ensuremath \overline{a_{#1}}}
\newcommand{\varProperty}[1][]{\ensuremath \pi_{#1}}
\newcommand{\varHyperProperty}[1][]{\ensuremath \Pi_{#1}}
\newcommand{\varClass}[1][]{\ensuremath \mathbb{C}_{#1}}

% language specific versions of above
%% src
\newcommand{\srcWholeProg}[1][]{\ensuremath \src{\varWholeProg[#1]}}
\newcommand{\srcComponent}[1][]{\ensuremath \src{\varComponent[#1]}}
\newcommand{\srcContext}[1][]{\ensuremath \src{\varContext[#1]}}
\newcommand{\srcRuntimeTerm}[1][]{\ensuremath \src{\varRuntimeTerm[#1]}}

\newcommand{\srcTrace}[1][]{\ensuremath \src{\varTrace[#1]}}
\newcommand{\srcProperty}[1][]{\ensuremath \src{\varProperty[#1]}}
\newcommand{\srcHyperProperty}[1][]{\ensuremath \src{\varHyperProperty[#1]}}
\newcommand{\srcClass}[1][]{\ensuremath \src{\varClass[#1]}}
%% trg
\newcommand{\trgWholeProg}[1][]{\ensuremath \trg{\varWholeProg[#1]}}
\newcommand{\trgComponent}[1][]{\ensuremath \trg{\varComponent[#1]}}
\newcommand{\trgContext}[1][]{\ensuremath \trg{\varContext[#1]}}
\newcommand{\trgRuntimeTerm}[1][]{\ensuremath \trg{\varRuntimeTerm[#1]}}

\newcommand{\trgTrace}[1][]{\ensuremath \trg{\varTrace[#1]}}
\newcommand{\trgProperty}[1][]{\ensuremath \trg{\varProperty[#1]}}
\newcommand{\trgHyperProperty}[1][]{\ensuremath \trg{\varHyperProperty[#1]}}
\newcommand{\trgClass}[1][]{\ensuremath \trg{\varClass[#1]}}

\newcommand{\bopLink}[2]{\ensuremath {#1}\bowtie{#2}}

% different kinds of satifsaction
\newcommand{\sat}[2]{\ensuremath \vdash {#1} : {#2}}
\newcommand{\rsat}[2]{\ensuremath \vdash_R {#1} : {#2}}

\newcommand{\rtp}[2]{\ensuremath\;\vdash{#1}:{#2}}
\newcommand{\rtpUniversal}[3]{\ensuremath\;\vdash^{\forall}_{{#3}}{#1}:{#2}}
\newcommand{\rtpExistential}[3]{\ensuremath\;\vdash^{\exists}_{{#3}}{#1}:{#2}}


\newcommand{\progstepto}[3]{\ensuremath{#1}\xRightarrow{#3}{#2}}


\newcommand{\cc}[2]{\ensuremath \gamma^{#1}_{#2}}
\newcommand{\ccST}{\ensuremath \cc{\src{S}}{\trg{T}}}


\newcommand{\mapUniversal}[2]{\ensuremath \overset{#1}{\varsigma}\left({#2}\right)}
\newcommand{\mapExistential}[2]{\ensuremath \overset{#1}{\tau}\left({#2}\right)}
\newcommand{\xrelTraces}[2]{\ensuremath {#1}\sim{#2}}


