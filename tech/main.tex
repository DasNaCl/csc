% Fixing: Too many math alphabets used in version normal.
\newcommand\hmmax{0}
\newcommand\bmmax{0}
\documentclass[utf8,acmsmall,review,screen,dvipsnames]{acmart}

\usepackage[colorinlistoftodos]{todonotes}
\usepackage[inference]{semantic}
\usepackage{fontawesome5}
\usepackage{listofitems}
\usepackage{glossaries}
\usepackage{cleveref}
\usepackage{stmaryrd}
\usepackage{marvosym}
\usepackage{listings}
\usepackage{xspace}
\usepackage{xfrac}
\usepackage{tikz}
\usepackage{soul}
\usepackage{bm}

\setul{0.95ex}{0.3ex}

% https://tex.stackexchange.com/questions/648845/sans-serif-uppercase-greek-no-longer-showing-in-acmart
\DeclareMathAlphabet{\mathsf}{OT1}{LibertinusSans-LF}{m}{n}
\SetMathAlphabet{\mathsf}{bold}{OT1}{LibertinusSans-LF}{bx}{n}

\DeclareMathAlphabet{\mathtt}{OT1}{lmtt}{m}{n}
\SetMathAlphabet{\mathtt}{bold}{OT1}{lmtt}{bx}{n}

\input{cmds.tex}

\loadglsentries{acronyms}
\makeglossaries

%% NOTE that a single column version may be required for 
%% submission and peer review. This can be done by changing
%% the \doucmentclass[...]{acmart} in this template to 
%% \documentclass[manuscript,screen]{acmart}
%% 
%% To ensure 100% compatibility, please check the white list of
%% approved LaTeX packages to be used with the Master Article Template at
%% https://www.acm.org/publications/taps/whitelist-of-latex-packages 
%% before creating your document. The white list page provides 
%% information on how to submit additional LaTeX packages for 
%% review and adoption.
%% Fonts used in the template cannot be substituted; margin 
%% adjustments are not allowed.
%%
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

\citestyle{acmauthoryear}

\begin{document}

\title{Secure Composition of Robust and Optimising Compilers}
\begin{abstract}
\begin{center}\small\it
	{This paper uses syntax highlighting accessible to both colourblind and black \& white readers.
	% ~\citep{patrignani2020use}.
% 	% Specifically, it makes use of a $\src{blue}$, $\src{sans\text{-}serif}$ font for a $\src{source}$,
% 	% a $\trg{red}$, $\trg{bold}$ font for an $\trg{intermediate}$,
% 	% and a $\obj{green}$, $\obj{teletype}$ font for a $\obj{target}$ language.
	}
\end{center}
\end{abstract}

\maketitle

\appendix

\section{General Trace Model}\label{ap:sec:gtm}

\begin{gather*}
  \begin{aligned}
  \mi{(Security\ Tag)}~\sigma\bnfdef&\ \lock \mid \unlock\hspace{0.5cm}
  \mi{(Control\ Tag)}~\sandboxtag\bnfdef \ctx\mid\comp\hspace{0.5cm}
  \mi{(Event)}~\event\bnfdef\ \emptyevent \mid \lightning \mid \event[_{b}];\sandboxtag;\sigma \\
  \mi{(Pre\text{-}event)}&~\event[_{b}]\bnfdef\ \ev{Alloc\ \loc\ n} \mid \ev{Dealloc\ \loc} \mid \ev{Use\ \loc\ n} \mid \ev{Branch\ n} \mid \ev{Binop\ n} \\
  \end{aligned}
\end{gather*}

Throughout the paper, sequences are indicated with an overbar (i.e., $\trace$), empty sequences with $\hole{\cdot}$, and concatenation of sequences $\trace[_{1}],\trace[_{2}]$ as $\trace[_{1}]\cdot\trace[_{2}]$.
Prepending elements to sequences uses the same notation: $\event\cdot\trace$.

\begin{definition}\label{ap:def:property}
  A property $\pi$ is a set of traces $\trace$.
\end{definition}
\begin{definition}\label{ap:def:propclass}
  A class $\class$ is a set of properties $\pi$.
\end{definition}
\begin{definition}\label{ap:def:lifting:properties}
  The lifting $\lift{\pi}$ of property $\pi$ is its powerset.
\end{definition}

\section{Properties and Monitors}\label{ap:sec:propmon}

In the following, $\traceagree[]{\pi}{\event}{\absevent}$ and the structure of $\abstrace$ are left abstract.
These are monitor-specific definitions, which are defined in \Cref{ap:subsec:tms,ap:subsec:sms,ap:subsec:ms,ap:subsec:scct,ap:subsec:msscct}.

\begin{figure}[!ht]
  \judgbox{\traceagree{\pi}{\trace}{\abstrace}}{,,Specification-level trace $\trace$ agrees with monitor-level trace $\abstrace$ with respect to property $\pi$.''}
  %
  \typerule{traceagree-empty}{}{
    \traceagree{\pi}{\hole{\cdot}}{\hole{\cdot}}
  }{traceagree-empty}
  %
  \typerule{traceagree-ign-L}{
    \traceagree{\pi}{\trace}{\abstrace}
  }{
    \traceagree{\pi}{\emptyevent\cdot\trace}{\abstrace}
  }{traceagree-ign-L}
  %
  \typerule{traceagree-ign-R}{
    \traceagree{\pi}{\trace}{\abstrace}
  }{
    \traceagree{\pi}{\trace}{\absev{\emptyevent}\cdot\abstrace}
  }{traceagree-ign-R}
  %
  \typerule{traceagree-cons}{
    \traceagree[]{\pi}{\event}{\absevent} &
    \traceagree{\pi}{\trace}{\abstrace}
  }{
    \traceagree{\pi}{\event\cdot\trace}{\absevent\cdot\abstrace}
  }{traceagree-cons}
  \caption{Trace-Agreement relation that equates specification-level traces with monitor-level traces.}\label{fig:stuttereq}
\end{figure}

\bul{A specification trace $\trace$ monitor-satisfies property $\pi$} iff there exists a (final) monitor state $\monitor$ and an abstract trace $\abstrace$ such that the \iul{specification trace $\trace$ agrees with abstract trace $\abstrace$} and \oul{the initial monitor can step to the (final) monitor state $\monitor$ with abstract trace $\abstrace$}.

\begin{definition}[Monitor Satisfaction]\label{def:monsat}
  \bul{$\monsafe{\trace}{\pi}$} $\isdef$ $\exists \abstrace\ \monitor$, \iul{$\traceagree{\pi}{\trace}{\abstrace}$} and \oul{$\monitorcheck{\emptyset}{\monitor}{\abstrace}$}.
\end{definition}

\subsection{Temporal Memory Safety}\label{ap:subsec:tms}

\begin{definition}[\glsfirst*{tms}]\label{ap:def:trace:tmsdef}
  \begin{displaymath}
  \tmssafe:=\left\{\trace \left| \begin{array}{rcl}
                              \ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}&\le_{\trace}&\ev{Dealloc\ \loc;\sandboxtag;\securitytag'} \\
                              \ev{Use\ \loc\ n;\sandboxtag;\securitytag}&\le_{\trace}&\ev{Dealloc\ \loc;\sandboxtag;\securitytag'} \\
                              \text{if }\ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}\text{ in }\trace&\text{then}&\ev{Dealloc\ \loc;\sandboxtag;\securitytag'}\text{ in }\trace \\
                              \text{at most one }\ev{Dealloc\ \loc;\sandboxtag;\securitytag}&\text{in}&\trace \\
                              \text{at most one }\ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}&\text{in}&\trace \\
                            \end{array}\right.\right\}
  \end{displaymath}
\end{definition}
Hereby, the notation $\event[_{1}]\le_{\trace}\event[_{2}]$ means that if $\event[_{1}]$ is in $\trace$ and if $\event[_{2}]$ is in $\trace$, then $\event[_{1}]$ appears before $\event[_{2}]$.

$$\;$$
\hrule
$$\;$$
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\tmsmonitor\bnfdef&\ \left\{\text{allocated}:L\times\sandboxtag,\text{freed}:L\times\sandboxtag\right\} \\
    \mi{(Initial\ Abstract\ Store)}~\emptytmsmon:=&\ \left\{\text{allocated}:\emptyset,\text{freed}:\emptyset\right\}\\
    \mi{(Abstract\ Events)}~\tmsevent\bnfdef&\ \absev{\emptyevent} \mid \absev{Alloc\ }\loc\ \sandboxtag \mid \absev{Dealloc\ }\loc\ \sandboxtag \mid \absev{Use\ }\loc\ \sandboxtag \mid \absterm\\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\tmsevent}}{,,Monitor $\tmsmonitor$ does one step to $\tmsmonitor[']$ given event $\tmsevent$.''}$\;$\\
  %
  \typerule{tms-uninteresting}{
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor}{\absev{\emptyevent}}
  }{ap:tms-uninteresting}
  %
  \typerule{tms-abort}{
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor}{\absterm}
  }{ap:tms-abort}
  %
  \typerule{tms-use}{
    (\loc;\sandboxtag)\in\tmsmonitor.\text{allocated} &
    (\loc;\sandboxtag)\notin\tmsmonitor.\text{freed}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor}{\absev{Use\ }\loc\ \sandboxtag}
  }{ap:tms-use}
  %
  \typerule{tms-alloc}{
    (\loc;\sandboxtag)\notin\tmsmonitor.\text{allocated} &
    (\loc;\sandboxtag)\notin\tmsmonitor.\text{freed} \\
    \tmsmonitor[']=\left\{\text{allocated}: \tmsmonitor.\text{allocated}\cup\left\{(\loc;\sandboxtag)\right\},\text{freed}: \tmsmonitor.\text{freed}\right\}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absev{Alloc\ }\loc\ \sandboxtag}
  }{ap:tms-alloc}
  %
  \typerule{tms-dealloc}{
    (\loc;\sandboxtag)\in\tmsmonitor.\text{allocated} &
    (\loc;\sandboxtag)\notin\tmsmonitor.\text{freed} \\
    \tmsmonitor[']=\left\{\text{allocated}: \tmsmonitor.\text{allocated}\setminus\left\{(\loc;\sandboxtag)\right\},\text{freed}: \tmsmonitor.\text{freed}\cup\left\{(\loc;\sandboxtag)\right\}\right\}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absev{Dealloc\ }\loc\ \sandboxtag}
  }{ap:tms-dealloc}
\end{center}
\begin{center}
  \judgbox{\monitorcheck{\tmsmonitor}{\tmsmonitor[']}{\tmstrace}}{,,Monitor $\tmsmonitor$ multi-steps to $\tmsmonitor[']$ given trace $\tmstrace$.''}$\;$\\
  %
  \typerule{tms-refl}{
    \tmsmonitor.\text{allocated}=\emptyset
  }{
    \monitorcheck{\tmsmonitor}{\tmsmonitor}{\hole{\cdot}}
  }{ap:tms-refl}
  %
  \typerule{tms-ign-trans}{
    \monitorcheck{\tmsmonitor}{\tmsmonitor[']}{\tmstrace}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\absev{\emptyevent}\cdot\tmstrace}
  }{ap:tms-ign-trans}
  %
  \typerule{tms-trans}{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\tmsevent} &
    \monitorcheck{\tmsmonitor[']}{\tmsmonitor['']}{\tmstrace}
  }{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor['']}{\tmsevent\cdot\tmstrace}
  }{ap:tms-trans}
\end{center}
\begin{center}
  \judgbox{\tmstraceagree[]{\event}{\tmsevent}}{,,Abstract event $\tmsevent$ is equivalent to $\event$ with respect to \gls*{tms}.''}$\;$\\
  %
  \typerule{tms-alloc-authentic}{
  }{
    \tmstraceagree[]{\ev{Alloc}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Alloc\ }\loc\ \sandboxtag}
  }{ap:tms-alloc-authentic}
  %
  \typerule{tms-dealloc-authentic}{
  }{
    \tmstraceagree[]{\ev{Dealloc}\ \loc;\sandboxtag;\securitytag}{\absev{Dealloc\ }\loc}
  }{ap:tms-dealloc-authentic}
  %
  \typerule{tms-use-authentic}{
  }{
    \tmstraceagree[]{\ev{Use}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Use\ }\loc}
  }{ap:tms-use-authentic}
  %
  \typerule{tms-branch-authentic}{
  }{
    \tmstraceagree[]{\ev{Branch\ }n}{\absev{\emptyevent}}
  }{ap:tms-branch-authentic}
  %
  \typerule{tms-binop-authentic}{
  }{
    \tmstraceagree[]{\ev{Binop\ }n}{\absev{\emptyevent}}
  }{ap:tms-binop-authentic}
  %
  \typerule{tms-empty-authentic}{
  }{
    \tmstraceagree[]{\emptyevent}{\absev{\emptyevent}}
  }{ap:tms-empty-authentic}
  %
  \typerule{tms-abort-authentic}{
  }{
    \tmstraceagree[]{\lightning}{\absterm}
  }{ap:tms-abort-authentic}
\end{center}

\begin{lemma}[Traces with Monitor Satisfaction are $\tmssafe$]\label{ap:lem:mon:tmssafe}
  If $\montmssafe{\trace}$, then $\trace\in\tmssafe$. %\Coqed
\end{lemma}
\begin{incompleteproof}
\end{incompleteproof}

\subsection{Spatial Memory Safety}\label{ap:subsec:sms}

\begin{definition}[\glsfirst*{sms}]\label{ap:def:trace:smsdef}
  \begin{displaymath}
  \smssafe:=\left\{\trace \left|\begin{array}{rcl}
                                  \text{If }\ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}\le_{\trace}\ev{Use\ \loc\ m;\sandboxtag;\securitytag'}, \text{ then }m<n
                                \end{array}\right.\right\}
  \end{displaymath}
\end{definition}
$$\;$$
\hrule
$$\;$$
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\smsmonitor:=&\ L\times\sandboxtag\times\mb{N}\mid\emptysmsmon\\
    \mi{(Abstract\ Events)}~\smsevent\bnfdef&\ \absev{\varepsilon} \mid \absev{Alloc\ }\loc\ \sandboxtag\ n \mid \absev{Use\ }\loc\ \sandboxtag\ n \\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\smsevent}}{,,Monitor $\smsmonitor$ does one step to $\smsmonitor[']$ given event $\smsevent$.''}$\;$\\
  %
  \typerule{sms-uninteresting}{
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor}{\absev{\emptyevent}}
  }{ap:sms-uninteresting}
  %
  \typerule{sms-abort}{
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor}{\absterm}
  }{ap:sms-abort}
  %
  \typerule{sms-use}{
    (\loc;\sandboxtag;m)\in\smsmonitor &
    n<m
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor}{\absev{Use\ }\loc\ \sandboxtag\ n}
  }{ap:sms-use}
  %
  \typerule{sms-alloc}{
    (\loc;\sandboxtag;m)\notin\smsmonitor
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor\cup\left\{(\loc;\sandboxtag;n)\right\}}{\absev{Alloc\ }\loc\ \sandboxtag\ n}
  }{ap:sms-alloc}
\end{center}
\begin{center}
  \judgbox{\monitorcheck{\smsmonitor}{\smsmonitor[']}{\smstrace}}{,,Monitor $\smsmonitor$ multi-steps to $\smsmonitor[']$ given trace $\smstrace$.''}$\;$\\
  %
  \typerule{sms-refl}{
  }{
    \monitorcheck{\smsmonitor}{\smsmonitor}{\hole{\cdot}}
  }{ap:sms-refl}
  %
  \typerule{sms-ign-trans}{
    \monitorcheck{\smsmonitor}{\smsmonitor[']}{\smstrace}
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\absev{\emptyevent}\cdot\smstrace}
  }{ap:sms-ign-trans}
  %
  \typerule{sms-trans}{
    \monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\smsevent} &
    \monitorcheck{\smsmonitor[']}{\smsmonitor['']}{\smstrace}
  }{
    \monitorcheck[]{\smsmonitor}{\smsmonitor['']}{\smsevent\cdot\smstrace}
  }{ap:sms-trans}
\end{center}
\begin{center}
  \judgbox{\smstraceagree[]{\event}{\smsevent}}{,,Abstract event $\smsevent$ is equivalent to $\event$ with respect to \gls*{sms}.''}$\;$\\
  %
  \typerule{sms-alloc-authentic}{
  }{
    \smstraceagree[]{\ev{Alloc}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Alloc\ }\loc\ n}
  }{ap:sms-alloc-authentic}
  %
  \typerule{sms-dealloc-authentic}{
  }{
    \smstraceagree[]{\ev{Dealloc}\ \loc;\sandboxtag;\securitytag}{\absev{Dealloc\ }\loc}
  }{ap:sms-dealloc-authentic}
  %
  \typerule{sms-use-authentic}{
  }{
    \smstraceagree[]{\ev{Use}\ \loc\ n;\sandboxtag;\securitytag}{\absev{Use\ }\loc\ n}
  }{ap:sms-use-authentic}
  %
  \typerule{sms-branch-authentic}{
  }{
    \smstraceagree[]{\ev{Branch\ }n}{\absev{\emptyevent}}
  }{ap:sms-branch-authentic}
  %
  \typerule{sms-binop-authentic}{
  }{
    \smstraceagree[]{\ev{Binop\ }n}{\absev{\emptyevent}}
  }{ap:sms-binop-authentic}
  %
  \typerule{sms-empty-authentic}{
  }{
    \smstraceagree[]{\emptyevent}{\absev{\emptyevent}}
  }{ap:sms-empty-authentic}
  %
  \typerule{sms-abort-authentic}{
  }{
    \smstraceagree[]{\lightning}{\absterm}
  }{ap:sms-abort-authentic}
\end{center}
\begin{lemma}[Traces with Monitor Satisfaction are $\smssafe$]\label{ap:lem:mon:smssafe}
  If $\monsmssafe{\trace}$, then $\trace\in\smssafe$.\Coqed
\end{lemma}
\begin{proof}
  First, generalize \Cref{ap:def:trace:smsdef} as follows:
  \begin{displaymath}
    \gsmssafe:=\left\{\trace \left|\begin{array}{rcl}
                                    \text{If }\ev{Alloc\ \loc\ n;\sandboxtag;\securitytag}\le_{\trace}\ev{Use\ \loc\ m;\sandboxtag;\securitytag'}\\
                                    \text{or }(\ev{Use\ \loc\ m;\sandboxtag;\securitytag}\text{ in }\trace\text{ and }(\loc,\sandboxtag,n)\in\smsmonitor),\\
                                    \text{ then }m<n
                                  \end{array}\right.\right\}
  \end{displaymath}
  Then, show ,,If $\mongsmssafe{\trace}$, then $\trace\in\gsmssafe$.'' by inducing on the monitor steps.

  Now specialize this generalization to $\smsmonitor=\emptyset$ and the claim follows as a corollary.
\end{proof}

\subsection{Memory Safety}\label{ap:subsec:ms}

\begin{definition}[\glsfirst*{ms}]\label{ap:def:trace:msdef}
  \begin{displaymath}
    \mssafe:=\tmssafe \cap \smssafe
  \end{displaymath}
\end{definition}
$$\;$$
\hrule
$$\;$$
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\msmonitor:=&\ \tmsmonitor\times\smsmonitor\\
    \mi{(Initial\ Abstract\ Store)}~\emptymsmon:=&\ (\emptytmsmon, \emptysmsmon) \\
    \mi{(Abstract\ Events)}~\msevent:=&\ \tmsevent\times\smsevent \mid \absev{\emptyevent}\\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\msmonitor}{\msmonitor[']}{\msevent}}{,,Monitor $\msmonitor$ does one step to $\msmonitor[']$ given event $\msevent$.''}$\;$\\
  %
  \typerule{ms-step}{
    \monitorcheck[]{\tmsmonitor}{\tmsmonitor[']}{\tmsevent} &
    \monitorcheck[]{\smsmonitor}{\smsmonitor[']}{\smsevent}
  }{
    \monitorcheck[]{(\tmsmonitor,\smsmonitor)}{(\tmsmonitor['],\smsmonitor['])}{(\tmsevent,\smsevent)}
  }{ap:ms-step}
\end{center}
\begin{center}
  \judgbox{\monitorcheck{\msmonitor}{\msmonitor[']}{\mstrace}}{,,Monitor $\msmonitor$ multi-steps to $\msmonitor[']$ given trace $\mstrace$.''}$\;$\\
  %
  \typerule{ms-refl}{
    \monitorcheck{\tmsmonitor}{\tmsmonitor}{\hole{\cdot}} &
    \monitorcheck{\smsmonitor}{\smsmonitor}{\hole{\cdot}}
  }{
    \monitorcheck{(\tmsmonitor,\smsmonitor)}{(\tmsmonitor,\smsmonitor)}{\hole{\cdot}}
  }{ap:ms-refl}
  %
  \typerule{ms-ign-trans}{
    \monitorcheck{\msmonitor}{\msmonitor[']}{\mstrace}
  }{
    \monitorcheck[]{\msmonitor}{\msmonitor[']}{\absev{\emptyevent}\cdot\mstrace}
  }{ap:ms-ign-trans}
  %
  \typerule{ms-trans}{
    \monitorcheck[]{\msmonitor}{\msmonitor[']}{\msevent} &
    \monitorcheck{\msmonitor[']}{\msmonitor['']}{\mstrace}
  }{
    \monitorcheck[]{\msmonitor}{\msmonitor['']}{\msevent\cdot\mstrace}
  }{ap:ms-trans}
\end{center}
\begin{center}
  \judgbox{\mstraceagree[]{\event}{\msevent}}{,,Abstract event $\msevent$ is equivalent to $\event$ with respect to \gls*{ms}.''}$\;$\\
  %
  \typerule{ms-some-authentic}{
    \tmstraceagree[]{\event}{\tmsevent} &
    \smstraceagree[]{\event}{\smsevent}
  }{
    \mstraceagree[]{\event}{(\tmsevent,\smsevent)}
  }{ap:ms-some-authentic}
  %
  \typerule{ms-none-authentic}{
    \tmstraceagree[]{\event}{\absev{\emptyevent}} &
    \smstraceagree[]{\event}{\absev{\emptyevent}}
  }{
    \mstraceagree[]{\event}{\absev{\emptyevent}}
  }{ap:ms-none-authentic}
\end{center}

\begin{lemma}[Traces with Monitor Satisfaction are $\mssafe$]\label{ap:lem:mon:mssafe}
  If $\monmssafe{\trace}$, then $\trace\in\mssafe$.\Coqed
\end{lemma}
\begin{proof}
  Corollary of \Cref{ap:lem:mon:tmssafe,ap:lem:mon:smssafe}.
\end{proof}

\subsection{Strict Cryptographic Constant Time}\label{ap:subsec:scct}

\begin{definition}[\glsfirst*{scct}]\label{ap:def:trace:scctdef}
  \begin{displaymath}
    \scctsafe:=\left\{\trace \left|\begin{array}{rcl}
                                     \trace=\hole{\cdot} & \text{ or } & \trace=\event[_{b}];\sandboxtag;\unlock\cdot\trace['] \wedge \trace[']\in\scctsafe
                                   \end{array}\right.\right\}
  \end{displaymath}
\end{definition}
$$\;$$
\hrule
$$\;$$
\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\scctmonitor:=&\ \emptyscctmon\\
    \mi{(Abstract\ Events)}~\scctevent:=&\ \absev{\emptyevent} \mid \absev{\lightning} \mid \absev{Any} \\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\scctevent}}{,,Monitor $\scctmonitor$ does one step to $\scctmonitor[']$ given event $\scctevent$.''}$\;$\\
  %
  \typerule{scct-none}{
  }{
    \monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\absev{\emptyevent}}
  }{ap:scct-none}
  %
  \typerule{scct-abort}{
  }{
    \monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\absev{\lightning}}
  }{ap:scct-abort}
\end{center}
\begin{center}
  \judgbox{\monitorcheck{\scctmonitor}{\scctmonitor[']}{\sccttrace}}{,,Monitor $\scctmonitor$ multi-steps to $\scctmonitor[']$ given trace $\sccttrace$.''}$\;$\\
  %
  \typerule{scct-refl}{
  }{
    \monitorcheck{\scctmonitor}{\scctmonitor}{\hole{\cdot}}
  }{ap:scct-refl}
  %
  \typerule{scct-ign-trans}{
    \monitorcheck{\scctmonitor}{\scctmonitor[']}{\sccttrace}
  }{
    \monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\absev{\emptyevent}\cdot\sccttrace}
  }{ap:scct-ign-trans}
  %
  \typerule{scct-trans}{
    \monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\scctevent} &
    \monitorcheck{\scctmonitor[']}{\scctmonitor['']}{\sccttrace}
  }{
    \monitorcheck[]{\scctmonitor}{\scctmonitor['']}{\scctevent\cdot\sccttrace}
  }{ap:scct-trans}
\end{center}
\begin{center}
  \judgbox{\sccttraceagree[]{\event}{\absevent}}{,,Abstract event $\absevent$ is equivalent to $\event$ with respect to \gls*{cct}.''}$\;$\\
  %
  \typerule{scct-low-authentic}{
  }{
    \sccttraceagree[]{\event[_b];\sandboxtag;\unlock}{\absev{\emptyevent}}
  }{ap:scct-low-authentic}
  %
  \typerule{scct-high-authentic}{
  }{
    \sccttraceagree[]{\event[_b];\sandboxtag;\lock}{\absev{Any}}
  }{ap:scct-high-authentic}
  %
  \typerule{scct-empty-authentic}{
  }{
    \sccttraceagree[]{\emptyevent}{\absev{\emptyevent}}
  }{ap:scct-empty-authentic}
  %
  \typerule{scct-abort-authentic}{
  }{
    \sccttraceagree[]{\lightning}{\absterm}
  }{ap:scct-abort-authentic}
\end{center}
\begin{lemma}[Monitor Traces are $\scctsafe$]\label{lem:mon:scctsafe}
  If $\monscctsafe{\trace}$, then $\trace\in\scctsafe$. %\Coqed
\end{lemma}
\begin{incompleteproof}
\end{incompleteproof}

\subsection{Memory Safety and Strict Cryptographic Constant Time}\label{ap:subsec:msscct}
\begin{definition}[\glsfirst*{msscct}]\label{ap:def:trace:msscctdef}
  \begin{displaymath}
    \msscctsafe:=\mssafe\cap\scctsafe
  \end{displaymath}
\end{definition}
$$\;$$
\hrule
$$\;$$

\begin{gather*}
  \begin{aligned}
    \mi{(Abstract\ Store)}~\msscctmonitor:=&\ \msmonitor\times\scctmonitor\\
    \mi{(Initial\ Abstract\ Store)}~\emptymsscctmon:=&\ (\emptymsscctmon, \emptyscctmon) \\
    \mi{(Abstract\ Events)}~\msscctevent:=&\ \msscctevent\times\scctevent \mid \absev{\emptyevent}\\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\monitorcheck[]{\msscctmonitor}{\msscctmonitor[']}{\msscctevent}}{,,Monitor $\msscctmonitor$ does one step to $\msscctmonitor[']$ given event $\msscctevent$.''}$\;$\\
  %
  \typerule{msscct-step}{
    \monitorcheck[]{\msmonitor}{\msmonitor[']}{\msevent} &
    \monitorcheck[]{\scctmonitor}{\scctmonitor[']}{\scctevent}
  }{
    \monitorcheck[]{(\msmonitor,\scctmonitor)}{(\msmonitor['],\scctmonitor['])}{(\msevent,\scctevent)}
  }{ap:msscct-step}
\end{center}
\begin{center}
  \judgbox{\monitorcheck{\msscctmonitor}{\msscctmonitor[']}{\mssccttrace}}{,,Monitor $\msscctmonitor$ multi-steps to $\msscctmonitor[']$ given trace $\mssccttrace$.''}$\;$\\
  %
  \typerule{msscct-refl}{
    \monitorcheck{\msmonitor}{\msmonitor}{\hole{\cdot}} &
    \monitorcheck{\scctmonitor}{\scctmonitor}{\hole{\cdot}}
  }{
    \monitorcheck{(\msmonitor,\scctmonitor)}{(\msmonitor,\scctmonitor)}{\hole{\cdot}}
  }{ap:msscct-refl}
  %
  \typerule{msscct-ign-trans}{
    \monitorcheck{\msscctmonitor}{\msscctmonitor[']}{\mssccttrace}
  }{
    \monitorcheck[]{\msscctmonitor}{\msscctmonitor[']}{\absev{\emptyevent}\cdot\mssccttrace}
  }{ap:msscct-ign-trans}
  %
  \typerule{msscct-trans}{
    \monitorcheck[]{\msscctmonitor}{\msscctmonitor[']}{\msscctevent} &
    \monitorcheck{\msscctmonitor[']}{\msscctmonitor['']}{\mssccttrace}
  }{
    \monitorcheck[]{\msscctmonitor}{\msscctmonitor['']}{\msscctevent\cdot\mssccttrace}
  }{ap:msscct-trans}
\end{center}
\begin{center}
  \judgbox{\mssccttraceagree[]{\event}{\msscctevent}}{,,Abstract event $\msscctevent$ is equivalent to $\event$ with respect to \gls*{ms}.''}$\;$\\
  %
  \typerule{msscct-some-authentic}{
    \mstraceagree[]{\event}{\msevent} &
    \sccttraceagree[]{\event}{\scctevent}
  }{
    \mssccttraceagree[]{\event}{(\msevent,\scctevent)}
  }{ap:msscct-some-authentic}
  %
  \typerule{msscct-none-authentic}{
    \mstraceagree[]{\event}{\absev{\emptyevent}} &
    \sccttraceagree[]{\event}{\absev{\emptyevent}}
  }{
    \mssccttraceagree[]{\event}{\absev{\emptyevent}}
  }{ap:msscct-none-authentic}
\end{center}

\begin{lemma}[Traces with Monitor Satisfaction are $\msscctsafe$]\label{ap:lem:mon:msscctsafe}
  If $\monmsscctsafe{\trace}$, then $\trace\in\msscctsafe$.\Coqed
\end{lemma}
\begin{incompleteproof}
\end{incompleteproof}

\section{Programming Languages}\label{ap:sec:proglangs}

\subsection{$\Ltms$: Statically Typed, Temporal Memory Safe, Strict Cryptographic Constant Time}

$\Ltms$ trivially satisfies \gls*{scct}, because all variables/values are private ($\lock$) by default.
This is ,,enforced'' when projecting $\src{\Ltms}$ events to the general trace model presented in \Cref{ap:sec:gtm}.

\begin{gather*}
  \begin{aligned}
    \mi{(Expressions)}~&\src{\expr}\bnfdef\ \src{x} \mid \src{\valueexpr} \mid \src{\lbinop{\expr[_{1}]}{\expr[_{2}]}} \mid \src{\lget{x}{\expr}} \mid \src{\lnew{x}{\expr[_{1}]}{\expr[_{2}]}{\expr[_{3}]}} \mid \src{\ldelete{x}} \mid \src{\lset{x}{\expr[_{1}]}{\expr[_{2}]}} \\
                       & \mid \src{\lpair{\expr[_{1}]}{\expr[_{2}]}} \mid \src{\lproja{\expr}} \mid \src{\lprojb{\expr}} \mid \src{\llet{x}{\expr[_{1}]}{\expr[_{2}]}} \mid \src{\lreturn{\expr}} \mid \src{\lcall{g}{\expr}} \mid \src{\lifz{\expr}{\expr[_{1}]}{\expr[_{2}]}} \mid \src{\labort}
  \end{aligned}
  \\
  \begin{aligned}
  \mi{(Types)}~&\src{\type}\bnfdef\src{\natt} \mid \src{\ptr} \mid \src{\wptr} \mid \src{\type[_{1}] \times \type[_{2}]}
  &
  \mi{(Type~Enviroments)}~&\src{\typenv}\bnfdef\src{\hole{\cdot}} \mid \src{x:\type,\typenv} \mid \src{x:\type[_1]\to\type[_2],\typenv}
  \end{aligned}\\
  \begin{aligned}
  \mi{(Functions)}~&\src{\function}\bnfdef\ \src{\lfunction{\textit{foo}}{x}{e}}
  &
\mi{(Libraries)}~&\src{\library}\bnfdef\ \src{\hole{\cdot}} \mid \src{\function},\src{\library}
  \end{aligned}\\
  \begin{aligned}
  \mi{(Component~Names)}~&\src{\commlib}\bnfdef\ \src{\hole{\cdot}} \mid \src{\text{foo}},\src{\commlib}
  &
  \mi{(Programs)}~&\src{\prog{\library_{\ctx}}{\library_{\comp}}}
  \end{aligned}
\end{gather*}

Variables are referred to as $x,y,z,a,b,c,\ldots$ while functions may be referred to as multi-character words, such as $\texttt{foo}$, as well as short-forms like $f,g,h$.

\begin{gather*}
  \begin{aligned}
    \mi{(Control~Tags)}~&\src{\sandboxtag}\bnfdef\src{\ctx} \mid \src{comp}
    &
    \mi{(Communication~Tags)}~&\src{\comm}\bnfdef\ \src{\ctxtocomp} \mid\ \src{\comptoctx} \mid \src{\nocomm}
    &
    \mi{(Poison~Tags)}~&\src{\poison}\bnfdef \src{\poisoned} \mid \src{\poisonless}
  \end{aligned}\\
  \begin{aligned}
    \mi{(Continuation~Stacks)}~&\src{\ectxstack}\bnfdef\src{\hole{\cdot}} \mid \src{\tup{K}{g}},\src{\ectxstack}
    &
    \mi{(Control~Flow~States)}~&\src{\cfstate}\bnfdef\src{\tup{\library}{\ectxstack}}
  	\\
    \mi{(Locations)}~&\src{\loc}\in\nat
    &
    \mi{(Substitutions)}~&\src{\substvar}\bnfdef \src{\hole{\cdot}} \mid \src{\subst{\valueexpr}{x}},\src{\gamma}
  	\\
    \mi{(Stores)}~&\src{\Delta}\bnfdef\src{\hole{\cdot}} \mid \src{x\mapsto\tup{\loc}{\sandboxtag,\poison,n}},\src{\Delta}
    &
    \mi{(Heaps)}~&\src{H}\bnfdef\src{\hole{\cdot}} | \src{\valueexpr},\src{H}
  \end{aligned}\\
  \begin{aligned}
    \mi{(Memory~States)}~&\src{\memstate}\bnfdef\src{\tup{H^{\ctx}}{H^{\comp};\Delta}}
    &
    \mi{(States)}~&\src{\statevar}\bnfdef\src{\tup{\cfstate}{\sandboxtag,\memstate}}
    &
    \mi{(Runtime~Terms)}~&\src{\runtimetermvar}\bnfdef\src{\rtt{\statevar}{\expr}} \mid \src{\lightning}
  \end{aligned}
\end{gather*}
Throughout the paper, the substitution notation is also used to update entries in states $\statevar$.

\begin{center}
  \judgbox{\noownedptr{\src{\type}}}{,,Type $\src{\type}$ does not entail an owned pointer.''}
  %
  \typerule{$\src{\Ltms}-\text{noownedptr}-\src{\natt}$}{
  }{
    \noownedptr{\src{\natt}}
  }{ap:ltms-noownedptr-natt}
  %
  \typerule{$\src{\Ltms}-\text{noownedptr}-\src{\wptr}$}{
  }{
    \noownedptr{\src{\wptr}}
  }{ap:ltms-noownedptr-wptr}
  %
  \typerule{$\src{\Ltms}-\text{noownedptr}-\text{pair}$}{
    \noownedptr{\src{\type[_1]}} &
    \noownedptr{\src{\type[_2]}}
  }{
    \noownedptr{\src{\type[_1]\times\type[_2]}}
  }{ap:ltms-noownedptr-pair}
\end{center}
\begin{center}
  \judgbox{\noownedptr{\src{\typenv}}}{,,$\src{\typenv}$ does not contain any owned pointers.''}
  %
  \typerule{$\src{\Ltms}-\text{noownedptr}-\text{empty}$}{
  }{
    \noownedptr{\src{\hole{\cdot}}}
  }{ap:ltms-noownedptr-empty}
  %
  \typerule{$\src{\Ltms}-\text{noownedptr}-\text{cons}$}{
    \noownedptr{\src{\type}} &
    \noownedptr{\src{\typenv}}
  }{
    \noownedptr{\src{x:\type,\typenv}}
  }{ap:ltms-noownedptr-cons}
\end{center}
\begin{center}
  \judgbox{\src{\typenv}\equiv\typenvsplit{\src{\typenv[']}}{\src{\typenv['']}}}{,,Split environment $\src{\typenv}$ into $\src{\typenv[']}$ and $\src{\typenv['']}$.''}
  %
  \typerule{$\src{\Ltms}-$split-empty}{
  }{
    \src{\hole{\cdot}} \equiv \typenvsplit{\src{\hole{\cdot}}}{\src{\hole{\cdot}}}
  }{ap:ltms-split-empty}
  %
  \typerule{$\src{\Ltms}-$split-emptyL}{
  }{
    \src{\typenv} \equiv \typenvsplit{\src{\hole{\cdot}}}{\src{\typenv}}
  }{ap:ltms-split-emptyL}
  %
  \typerule{$\src{\Ltms}-$split-emptyR}{
  }{
    \src{\typenv} \equiv \typenvsplit{\src{\typenv}}{\src{\hole{\cdot}}}
  }{ap:ltms-split-emptyR}
  %
  \typerule{$\src{\Ltms}$-split-$\natt$}{
    \src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{
    \src{x:\natt},\src{\typenv} \equiv \typenvsplit{\src{x:\natt},\src{\typenv[_1]}}{\src{x:\natt},\src{\typenv[_2]}}
  }{ap:ltms-split-natt}
  %
  \typerule{$\src{\Ltms}$-split-wptr}{
    \src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{
    \src{x:\wptr},\src{\typenv} \equiv \typenvsplit{\src{x:\wptr},\src{\typenv[_1]}}{\src{x:\wptr},\src{\typenv[_2]}}
  }{ap:ltms-split-wptr}
  %
  \typerule{$\src{\Ltms}$-split-pair}{
    \noownedptr{\src{\type[_1]\times\type[_2]}} &
    \src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{
    \src{x:\type[_1]\times\type[_2]},\src{\typenv} \equiv \typenvsplit{\src{x:\type[_1]},\src{\typenv[_1]}}{\src{x:\type[_2]},\src{\typenv[_2]}}
  }{ap:ltms-split-pair}
  %
  \typerule{$\src{\Ltms}$-split-ptrL}{
    \src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{
    \src{x:\ptr},\src{\typenv} \equiv \typenvsplit{\src{x:\ptr},\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{ap:ltms-split-ptrL}
  %
  \typerule{$\src{\Ltms}$-split-ptrR}{
    \src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{
    \src{x:\ptr},\src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{x:\ptr},\src{\typenv[_2]}}
  }{ap:ltms-split-ptrR}
  %
  \typerule{$\src{\Ltms}$-split-arrow}{
    \noownedptr{\src{\type[_1]}} &
    \noownedptr{\src{\type[_2]}} &
    \src{\typenv} \equiv \typenvsplit{\src{\typenv[_1]}}{\src{\typenv[_2]}}
  }{
  \src{foo:\type[_1]\to\type[_2]},\src{\typenv} \equiv \typenvsplit{\src{foo:\type[_1]\to\type[_2]},\src{\Gamma_1}}{\src{foo:\type[_1]\to\type[_2]},\src{\Gamma_2}}
  }{ap:ltms-split-arrow}
\end{center}

\begin{gather*}
  \begin{aligned}
    \mi{(Pre\text{-}Events)}~\src{\event[_{b}]}&\bnfdef \src{\ev{Alloc}\ \loc\ \valueexpr} \mid \src{\ev{Dealloc}\ \loc} \mid \src{\ev{Get}\ \loc\ \valueexpr} \mid \src{\ev{Set}\ \loc\ \valueexpr\ \valueexpr[']} \mid \src{\ev{Call}\ \comm\ g\ \valueexpr} \mid \src{\ev{Ret}\ \comm\ \valueexpr} \mid \src{\ev{Start}} \mid \src{\ev{End}\ \valueexpr}\\
  \end{aligned}\\
  \begin{aligned}
    \mi{(Events)}~\src{\event}&\bnfdef \src{\emptyevent} \mid \src{\lightning} \mid \src{\tup{\event[_{b}]}{\sandboxtag}} \\
  \end{aligned}
\end{gather*}
\begin{center}
  \judgbox{\pstepto{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\event}}}{,,$\src{\runtimetermvar}$ does one primitive step to $\src{\runtimetermvar[']}$ emitting event $\src{\event}$.''}
  %
  \typerule{$\src{\Ltms}-e-\text{binop}$}{
    \src{\lbinop{\expr[_1]}{\expr[_2]}}=\src{\expr[_3]}
  }{
    \pstepto{\src{\rtt{\statevar}{\lbinop{\expr[_1]}{\expr[_2]}}}}{\src{\rtt{\statevar}{\expr[_3]}}}{\src{\emptyevent}}
  }{ap:ltms-e-binop}
  %
  \typerule{$\src{\Ltms}-e-\text{get}-\in$}{
    \src{\sandboxtag}=\src{\statevar.\sandboxtag} &
    \src{\statevar.\store(x)}=\src{\tup{\loc}{\sandboxtag,\poison,m}} \\
    \src{\loc}+\src{n}\in\operatorname{dom}\src{\statevar.\heap[^{\sandboxtag}](\loc+n)}
  }{
    \pstepto{\src{\rtt{\statevar}{\lget{x}{n}}}}{\src{\rtt{\statevar}{\statevar.\heap[^{\sandboxtag}](\loc+n)}}}{\src{\tup{\ev{Get}\ \loc\ n}{\sandboxtag}}}
  }{ap:ltms-e-get-in}
  %
  \typerule{$\src{\Ltms}-e-\text{get}-\notin$}{
    \src{\sandboxtag}=\src{\statevar.\sandboxtag} &
    \src{\statevar.\store(x)}=\src{\tup{\loc}{\sandboxtag,\poison,m}} \\
    \src{\loc}+\src{n}\notin\operatorname{dom}\src{\statevar.\heap[^{\sandboxtag}](\loc+n)}
  }{
    \pstepto{\src{\rtt{\statevar}{\lget{x}{n}}}}{\src{\rtt{\statevar}{1729}}}{\src{\tup{\ev{Get}\ \loc\ n}{\sandboxtag}}}
  }{ap:ltms-e-get-notin}
  %
  \typerule{$\src{\Ltms}-e-\text{set}-\in$}{
    \src{\sandboxtag}=\src{\statevar.\sandboxtag} &
    \src{\statevar.\store(x)}=\src{\tup{\loc}{\sandboxtag,\poison,m}} \\
    \src{\loc}+\src{n}\in\operatorname{dom}\src{\statevar.\heap[^{\sandboxtag}]} &
    \src{\heap[']}=\seth{\src{\statevar.\heap[^{\sandboxtag}]}}{\src{\loc}+\src{n}}{\src{\valueexpr}}
  }{
    \pstepto{\src{\rtt{\statevar}{\lset{x}{n}{\valueexpr}}}}{\src{\rtt{\statevar\subst{\heap[^{\sandboxtag}]}{\heap[']}}{\valueexpr}}}{\src{\tup{\ev{Set}\ \loc\ n\ \valueexpr}{\sandboxtag}}}
  }{ap:ltms-e-set-in}
  %
  \typerule{$\src{\Ltms}-e-\text{set}-\notin$}{
    \src{\sandboxtag}=\src{\statevar.\sandboxtag} &
    \src{\statevar.\store(x)}=\src{\tup{\loc}{\sandboxtag,\poison,m}} \\
    \src{\loc}+\src{n}\notin\operatorname{dom}\src{\statevar.\heap[^{\sandboxtag}]}
  }{
    \pstepto{\src{\rtt{\statevar}{\lset{x}{n}{\valueexpr}}}}{\src{\rtt{\statevar}{\valueexpr}}}{\src{\tup{\ev{Set}\ \loc\ n\ \valueexpr}{\sandboxtag}}}
  }{ap:ltms-e-set-notin}
  %
  \typerule{$\src{\Ltms}-e-\text{new}$}{
    \fresh{\src{\statevar}}{\src{z}} &
    \fresh{\src{\statevar}}{\src{\loc}} &
    \src{\heap[^{\sandboxtag}_1]}=\growh{\src{\statevar.\heap[^{\sandboxtag}]}}{\src{n}}{\src{\valueexpr}} &
    \src{\store[_1]}=\src{\storeel{z}{\loc}{\statevar.\sandboxtag}{\poisonless}{n},\statevar.\store}
  }{
    \pstepto{\src{\rtt{\statevar}{\lnew{x}{\valueexpr}{n}{\expr}}}}{\src{\rtt{\statevar\subst{\heap[^{\sandboxtag}]}{\heap[^{\sandboxtag}_1]}\subst{\store}{\store[_1]}}{\expr\subst{z}{x}}}}{\src{\tup{\ev{Alloc}\ \loc\ n}{\statevar.\sandboxtag}}}
  }{ap:ltms-e-new}
  %
  \typerule{$\src{\Ltms}-e-\text{dealloc}$}{
    \src{\statevar.\store(x)} = \src{\tup{\loc}{\statevar.\sandboxtag,\poison,n}} &
    \src{\store[_1]}=\seth{\src{\statevar.\store}}{\src{x}}{\src{\tup{\loc}{\statevar.\sandboxtag,\poisoned,n}}}
  }{
    \pstepto{\src{\rtt{\statevar}{\ldelete{x}}}}{\src{\rtt{\statevar\subst{\store}{\store[_1]}}{0}}}{\src{\tup{\ev{Dealloc}\ \loc}{\statevar.\sandboxtag}}}
  }{ap:ltms-e-dealloc}
  %
  \typerule{$\src{\Ltms}-e-\text{let}$}{
  }{
    \pstepto{\src{\rtt{\statevar}{\llet{x}{\valueexpr}{\expr}}}}{\src{\rtt{\statevar}{\expr\subst{x}{\valueexpr}}}}{\src{\emptyevent}}
  }{ap:ltms-e-let}
  %
  \typerule{$\src{\Ltms}-e-\text{ifz}-yes$}{
  }{
    \pstepto{\src{\rtt{\statevar}{\lifz{0}{\expr[_1]}{\expr[_2]}}}}{\src{\rtt{\statevar}{\expr[_1]}}}{\src{\emptyevent}}
  }{ap:ltms-e-ifz-yes}
  %
  \typerule{$\src{\Ltms}-e-\text{ifz}-no$}{
    \src{n}\not=\src{0}
  }{
    \pstepto{\src{\rtt{\statevar}{\lifz{n}{\expr[_1]}{\expr[_2]}}}}{\src{\rtt{\statevar}{\expr[_2]}}}{\src{\emptyevent}}
  }{ap:ltms-e-ifz-no}
  %
  \typerule{$\src{\Ltms}-e-\text{proj}-a$}{
  }{
    \pstepto{\src{\rtt{\statevar}{\lproja{\lpair{\valueexpr[_1]}{\valueexpr[_2]}}}}}{\src{\rtt{\statevar}{\valueexpr[_1]}}}{\src{\emptyevent}}
  }{ap:ltms-e-proj-a}
  %
  \typerule{$\src{\Ltms}-e-\text{proj}-b$}{
  }{
    \pstepto{\src{\rtt{\statevar}{\lprojb{\lpair{\valueexpr[_1]}{\valueexpr[_2]}}}}}{\src{\rtt{\statevar}{\valueexpr[_2]}}}{\src{\emptyevent}}
  }{ap:ltms-e-proj-b}
  %
  \typerule{$\src{\Ltms}-e-\text{abort}$}{
  }{
    \pstepto{\src{\rtt{\statevar}{\labort}}}{\src{\lightning}}{\src{\lightning}}
  }{ap:ltms-e-abort}
\end{center}
\begin{center}
  \judgbox{\src{\commlib}\vdash\src{foo}:\src{\sandboxtag}\dashv\src{\comm},\src{\sandboxtag'}}{,,Determine communication tag $\src{\comm}$ and control tag $\src{\sandboxtag'}$ by checking the current control $\src{\sandboxtag}$,\\the called function $\src{foo}$, and list of component names $\src{\commlib}$.''}
  %
  \typerule{$\src{\Ltms}-\text{switch}-\ctx-\text{to}-\comp$}{
    \src{foo}\in\src{\commlib}
  }{
    \src{\commlib}\vdash\src{foo}:\src{\ctx}\dashv\src{\ctxtocomp},\src{\comp}
  }{ap:ltms-switch-ctx-to-comp}
  %
  \typerule{$\src{\Ltms}-\text{switch}-\comp-\text{to}-\ctx$}{
    \src{foo}\notin\src{\commlib}
  }{
    \src{\commlib}\vdash\src{foo}:\src{\comp}\dashv\src{\comptoctx},\src{\ctx}
  }{ap:ltms-switch-comp-to-ctx}
  %
  \typerule{$\src{\Ltms}-\text{noswitch}-\ctx$}{
    \src{foo}\notin\src{\commlib}
  }{
    \src{\commlib}\vdash\src{foo}:\src{\ctx}\dashv\src{\nocomm},\src{\ctx}
  }{ap:ltms-noswitch-ctx}
  %
  \typerule{$\src{\Ltms}-\text{noswitch}-\comp$}{
    \src{foo}\in\src{\commlib}
  }{
    \src{\commlib}\vdash\src{foo}:\src{\comp}\dashv\src{\nocomm},\src{\comp}
  }{ap:ltms-noswitch-comp}
\end{center}
\begin{center}
  \judgbox{\estepto[]{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\event}}}{,,$\src{\runtimetermvar}$ does one contextual step to $\src{\runtimetermvar[']}$ emitting event $\src{\event}$.''}
  %
  \typerule{$\src{\Ltms}-e-\text{ectx}$}{
    \pstepto{\src{\rtt{\statevar}{\expr}}}{\src{\rtt{\statevar[']}{\expr[']}}}{\src{\event}}
  }{
    \estepto[]{\src{\rtt{\statevar}{\ectx\hole{\expr}}}}{\src{\rtt{\statevar[']}{\ectx\hole{\expr[']}}}}{\src{\event}}
  }{ap:ltms-e-ectx}
  %
  \typerule{$\src{\Ltms}-e-\text{stuck}$}{
    \pstepto{\src{\rtt{\statevar}{\expr}}}{\src{\lightning}}{\src{\lightning}}
  }{
    \estepto[]{\src{\rtt{\statevar}{\ectx\hole{\expr}}}}{\src{\lightning}}{\src{\lightning}}
  }{ap:ltms-e-stuck}
  %
  \typerule{$\src{\Ltms}-e-\text{start}$}{
    \src{\lfunction{\text{main}}{x}{e}} \in \src{\statevar.\library} &
    \src{\statevar.\ectxstack}=\src{\hole{\cdot}}
  }{
    \estepto[]{\src{\rtt{\statevar}{\lcall{\text{main}}{0}}}}{\src{\rtt{\statevar\subst{\ctx}{\sandboxtag}\subst{\tup{\hole{\cdot}}{\text{main}},\hole{\cdot}}{\ectxstack}}{\expr\subst{0}{x}}}}{\src{\tup{\ev{Start}}{\comp}}}
  }{ap:ltms-e-start}
  %
  \typerule{$\src{\Ltms}-e-\text{ret}$}{
    \src{\statevar.\ectxstack}=\src{\tup{\ectx}{\text{foo}}},\src{\ectxstack[']} &
    \src{\commlib}\vdash\src{\text{foo}}:\src{\statevar.\sandboxtag}\dashv\src{\comm}
  }{
    \estepto[]{\src{\rtt{\statevar}{\ectx[']\hole{\lreturn{\valueexpr}}}}}{\src{\rtt{\statevar\subst{\neg\statevar.\sandboxtag}{\sandboxtag}\subst{\ectxstack[']}{\ectxstack}}{\ectx\hole{\valueexpr}}}}{\src{\tup{\ev{Ret}\ \comm\ \valueexpr}{\statevar.\sandboxtag}}}
  }{ap:ltms-e-ret}
  %
  \typerule{$\src{\Ltms}-e-\text{call}$}{
    \src{\lfunction{\text{foo}}{x}{e}} \in \src{\statevar.\library} &
    \src{\commlib}\vdash\src{\text{foo}}:\src{\statevar.\sandboxtag}\dashv\src{\comm}
  }{
    \estepto[]{\src{\rtt{\statevar}{\ectx\hole{\lcall{\text{foo}}{\valueexpr}}}}}{\src{\rtt{\statevar\subst{\neg\statevar.\sandboxtag}{\sandboxtag}\subst{\tup{\ectx}{\text{foo}},\statevar.\ectxstack}{\ectxstack}}{\expr\subst{\valueexpr}{x}}}}{\src{\tup{\ev{Call}\ \comm\ \text{foo}\ \valueexpr}{\statevar.\sandboxtag}}}
  }{ap:ltms-e-call}
  %
  \typerule{$\src{\Ltms}-e-\text{end}$}{
    \src{\statevar.\ectxstack}=\src{(\hole{\cdot},main),\hole{\cdot}}
  }{
    \estepto[]{\src{\rtt{\statevar}{\ectx\hole{\lreturn{\valueexpr}}}}}{\src{\rtt{\statevar\subst{\comp}{\sandboxtag}\subst{\tup{\hole{\cdot}}{\text{main}},\hole{\cdot}}{\ectxstack}}{\valueexpr}}}{\src{\tup{\ev{End}\ \valueexpr}{\ctx}}}
  }{ap:ltms-e-end}
\end{center}
\begin{center}
  \judgbox{\estepton{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\trace}}}{,,$\src{\runtimetermvar}$ performs $n$ steps to $\src{\runtimetermvar[']}$ emitting trace $\src{\trace}$.''}
  %
  \typerule{$\src{\Ltms}-\text{estepn}-\text{refl}$}{
  }{
    \estepton[0]{\src{\runtimetermvar}}{\src{\runtimetermvar}}{\src{\hole{\cdot}}}
  }{ap:ltms-estepn-refl}
  %
  \typerule{$\src{\Ltms}-\text{estepn}-\text{trans}-\text{important}$}{
    \src{\event}\not=\src{\emptyevent} &
    \estepto[]{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\event}} &
    \estepton[n]{\src{\runtimetermvar[']}}{\src{\runtimetermvar['']}}{\src{\trace}}
  }{
    \estepton[n+1]{\src{\runtimetermvar}}{\src{\runtimetermvar['']}}{\src{\event\cdot\trace}}
  }{ap:ltms-estepn-trans-important}
  %
  \typerule{$\src{\Ltms}-\text{estepn}-\text{trans}-\text{unimportant}$}{
    \estepto[]{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\emptyevent}} &
    \estepton[n]{\src{\runtimetermvar[']}}{\src{\runtimetermvar['']}}{\src{\trace}}
  }{
    \estepton[n+1]{\src{\runtimetermvar}}{\src{\runtimetermvar['']}}{\src{\trace}}
  }{ap:ltms-estepn-trans-unimportant}
\end{center}
\begin{center}
  \judgbox{\isfinal{\src{\runtimetermvar}}}{,,Runtime term $\src{\runtimetermvar}$ represents a final state.''}
  %
  \typerule{$\src{\Ltms}-\src{\lightning}-\text{is}-\text{final}$}{
  }{
    \isfinal{\src{\lightning}}
  }{ap:ltms-stuck-is-final}
  %
  \typerule{$\src{\Ltms}-\src{\valueexpr}-\text{is}-\text{final}$}{
  }{
    \isfinal{\src{\rtt{\statevar}{\valueexpr}}}
  }{ap:ltms-value-is-final}
\end{center}
\begin{center}
  \judgbox{\estepto{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\trace}}}{,,$\src{\runtimetermvar}$ steps to final $\src{\runtimetermvar[']}$ emitting trace $\src{\trace}$.''}
  %
  \typerule{$\src{\Ltms}-\text{esteps}-\text{refl}$}{
    \isfinal{\src{\runtimetermvar}}
  }{
    \estepto{\src{\runtimetermvar}}{\src{\runtimetermvar}}{\src{\hole{\cdot}}}
  }{ap:ltms-esteps-refl}
  %
  \typerule{$\src{\Ltms}-\text{esteps}-\text{trans}-\text{important}$}{
    \src{\event}\not=\src{\emptyevent} &
    \estepto[]{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\event}} &
    \estepto{\src{\runtimetermvar[']}}{\src{\runtimetermvar['']}}{\src{\trace}}
  }{
    \estepto{\src{\runtimetermvar}}{\src{\runtimetermvar['']}}{\src{\event\cdot\trace}}
  }{ap:ltms-esteps-trans-important}
  %
  \typerule{$\src{\Ltms}-\text{esteps}-\text{trans}-\text{unimportant}$}{
    \estepto[]{\src{\runtimetermvar}}{\src{\runtimetermvar[']}}{\src{\emptyevent}} &
    \estepto{\src{\runtimetermvar[']}}{\src{\runtimetermvar['']}}{\src{\trace}}
  }{
    \estepto{\src{\runtimetermvar}}{\src{\runtimetermvar['']}}{\src{\trace}}
  }{ap:ltms-esteps-trans-unimportant}
\end{center}

\bibliographystyle{ACM-Reference-Format}
\bibliography{main}

\end{document}
\endinput
%%
%% End of file `sample-sigconf.tex'.
